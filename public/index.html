
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VHICL Pro - Complete Shop Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .navbar {
            background: #2c3e50;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .navbar h1 {
            color: white;
            font-size: 24px;
            margin: 0;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: #3498db;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #3498db;
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.4);
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card .stat {
            font-size: 36px;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 10px;
        }

        .card .label {
            color: #7f8c8d;
            font-size: 14px;
        }

        .card.success .stat {
            color: #27ae60;
        }

        .card.warning .stat {
            color: #f39c12;
        }

        .card.danger .stat {
            color: #e74c3c;
        }

        .card.info .stat {
            color: #3498db;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            min-width: 250px;
        }

        .half {
            flex: 0 0 calc(50% - 10px);
        }

        .third {
            flex: 0 0 calc(33.333% - 13px);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.success {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-badge.primary {
            background: #cce5ff;
            color: #004085;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }

        .modal-header h2 {
            margin: 0;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .close-btn:hover {
            color: #e74c3c;
        }

        /* Invoice Line Items */
        .line-items {
            margin-top: 20px;
        }

        .line-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }

        .line-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .line-item-total {
            text-align: right;
            font-weight: 600;
            color: #2c3e50;
            margin-top: 10px;
        }

        .invoice-summary {
            background: #f8f9fa;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .summary-row.total {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            border-top: 2px solid #2c3e50;
            margin-top: 10px;
            padding-top: 10px;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .nav-buttons {
                width: 100%;
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .row {
                flex-direction: column;
            }

            .half,
            .third {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>\ud83d\ude97 VHICL Pro</h1>
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showScreen('homeScreen')">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="nav-btn" onclick="showScreen('alexScreen')">
                <i class="fas fa-robot"></i> ALEX
            </button>
            <button class="nav-btn" onclick="showScreen('appointmentsScreen')">
                <i class="fas fa-calendar"></i> Appointments
            </button>
            <button class="nav-btn" onclick="showScreen('estimatesScreen')">
                <i class="fas fa-file-invoice-dollar"></i> Estimates
            </button>
            <button class="nav-btn" onclick="showScreen('invoicesScreen')">
                <i class="fas fa-file-invoice"></i> Invoices
            </button>
            <button class="nav-btn" onclick="showScreen('partsStoresScreen')">
                <i class="fas fa-store"></i> Parts Stores
            </button>
            <button class="nav-btn" onclick="showScreen('analyticsScreen')">
                <i class="fas fa-chart-line"></i> Analytics
            </button>
            <button class="nav-btn" onclick="showScreen('techFlowScreen')">
                <i class="fas fa-user-tie"></i> Tech Flow
            </button>
            <button class="nav-btn" onclick="showScreen('settingsScreen')">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Screen -->
        <div id="homeScreen" class="screen active">
            <div class="section">
                <h2>\ud83d\udcca Today's Overview</h2>
                <div class="dashboard-grid">
                    <div class="card success">
                        <h3><i class="fas fa-dollar-sign"></i> Revenue</h3>
                        <div class="stat" id="todayRevenue">$0.00</div>
                        <div class="label">Total revenue today</div>
                    </div>
                    <div class="card info">
                        <h3><i class="fas fa-file-invoice"></i> Invoices</h3>
                        <div class="stat" id="todayInvoices">0</div>
                        <div class="label">Invoices generated today</div>
                    </div>
                    <div class="card warning">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Estimates</h3>
                        <div class="stat" id="todayEstimates">0</div>
                        <div class="label">Estimates created today</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-wrench"></i> Jobs</h3>
                        <div class="stat" id="todayJobs">0</div>
                        <div class="label">Jobs completed today</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>\u26a1 Quick Actions</h2>
                <div class="row">
                    <button class="btn btn-primary" onclick="openAppointmentModal()">
                        <i class="fas fa-plus"></i> New Appointment
                    </button>
                    <button class="btn btn-info" onclick="openEstimateModal()">
                        <i class="fas fa-file-invoice-dollar"></i> Create Estimate
                    </button>
                    <button class="btn btn-success" onclick="openInvoiceModal()">
                        <i class="fas fa-file-invoice"></i> Create Invoice
                    </button>
                    <button class="btn btn-warning" onclick="showScreen('alexScreen')">
                        <i class="fas fa-phone"></i> Call Parts Store
                    </button>
                </div>
            </div>
        </div>

        <!-- Estimates Screen -->
        <div id="estimatesScreen" class="screen">
            <div class="section">
                <h2>\ud83d\udccb Estimates</h2>
                
                <div class="form-group">
                    <div class="row">
                        <div class="half">
                            <input type="text" id="searchEstimates" placeholder="Search estimates..." onkeyup="searchEstimates()">
                        </div>
                        <div class="half">
                            <button class="btn btn-info" style="width: 100%;" onclick="openEstimateModal()">
                                <i class="fas fa-plus"></i> New Estimate
                            </button>
                        </div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Estimate #</th>
                            <th>Date</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="estimatesTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #7f8c8d;">No estimates found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Invoices Screen -->
        <div id="invoicesScreen" class="screen">
            <div class="section">
                <h2>\ud83d\udcc4 Invoices</h2>
                
                <div class="form-group">
                    <div class="row">
                        <div class="half">
                            <input type="text" id="searchInvoices" placeholder="Search invoices..." onkeyup="searchInvoices()">
                        </div>
                        <div class="half">
                            <button class="btn btn-success" style="width: 100%;" onclick="openInvoiceModal()">
                                <i class="fas fa-plus"></i> New Invoice
                            </button>
                        </div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Date</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoicesTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #7f8c8d;">No invoices found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Appointments Screen -->
        <div id="appointmentsScreen" class="screen">
            <div class="section">
                <h2>\ud83d\udcc5 Appointments</h2>
                
                <div class="form-group">
                    <div class="row">
                        <div class="third">
                            <input type="text" id="searchAppointments" placeholder="Search appointments..." onkeyup="searchAppointments()">
                        </div>
                        <div class="third">
                            <select id="filterAppointments" onchange="filterAppointments()">
                                <option value="all">All Appointments</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                        </div>
                        <div class="third">
                            <button class="btn btn-primary" style="width: 100%;" onclick="openAppointmentModal()">
                                <i class="fas fa-plus"></i> New Appointment
                            </button>
                        </div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Service</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="appointmentsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">No appointments found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tech Flow Screen -->
        <div id="techFlowScreen" class="screen">
            <div class="section">
                <h2>\ud83d\udc77 Technician Dashboard</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-tools"></i> Active Jobs</h3>
                        <div class="stat" id="techActiveJobs">0</div>
                        <div class="label">Jobs currently in progress</div>
                    </div>
                    <div class="card success">
                        <h3><i class="fas fa-check-circle"></i> Completed Today</h3>
                        <div class="stat" id="techCompletedToday">0</div>
                        <div class="label">Jobs completed today</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-clock"></i> Total Hours</h3>
                        <div class="stat" id="techTotalHours">0.0</div>
                        <div class="label">Hours worked today</div>
                    </div>
                    <div class="card warning">
                        <h3><i class="fas fa-star"></i> Rating</h3>
                        <div class="stat" id="techRating">0.0</div>
                        <div class="label">Customer rating (out of 5)</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>\ud83d\udd27 Active Jobs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Service</th>
                            <th>Bay</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="techActiveJobsTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #7f8c8d;">No active jobs</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2>\u2705 Recent Completed Jobs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Service</th>
                            <th>Hours</th>
                            <th>Completed</th>
                        </tr>
                    </thead>
                    <tbody id="techCompletedJobsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">No completed jobs today</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settingsScreen" class="screen">
            <div class="section">
                <h2>\u2699\ufe0f Shop Settings</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    Configure your shop's settings, credentials, and preferences.
                </p>
                
                <div class="form-group">
                    <label>Shop Name</label>
                    <input type="text" id="settingShopName" value="VHICL Pro Auto Shop">
                </div>

                <div class="form-group">
                    <label>Phone</label>
                    <input type="text" id="settingPhone" value="(555) 123-4567">
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="text" id="settingEmail" value="info@vhiclpro.com">
                </div>

                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="settingAddress" value="123 Main Street">
                </div>

                <div class="form-group">
                    <label>Labor Rate ($/hour)</label>
                    <input type="number" id="settingLaborRate" value="100">
                </div>

                <div class="form-group">
                    <label>Tax Rate (%)</label>
                    <input type="number" id="settingTaxRate" value="8">
                </div>

                <div class="form-group">
                    <label>Diagnostic Fee ($)</label>
                    <input type="number" id="settingDiagnosticFee" value="50">
                </div>

                <div class="form-group">
                    <label>Server URL</label>
                    <input type="text" id="settingServerUrl" value="https://vhicl-vapi-backend-puppeteer-production.up.railway.app">
                </div>

                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </div>

        <!-- Other screens (ALEX, Parts Stores, Analytics) would go here -->
        <div id="alexScreen" class="screen">
            <div class="section">
                <h2>\ud83e\udd16 ALEX - Voice Assistant</h2>
                <p style="color: #7f8c8d;">ALEX configuration and features coming soon.</p>
            </div>
        </div>

        <div id="partsStoresScreen" class="screen">
            <div class="section">
                <h2>\ud83c\udfea Parts Stores</h2>
                <p style="color: #7f8c8d;">Parts stores management coming soon.</p>
            </div>
        </div>

        <div id="analyticsScreen" class="screen">
            <div class="section">
                <h2>\ud83d\udcca Analytics</h2>
                <p style="color: #7f8c8d;">Analytics dashboard coming soon.</p>
            </div>
        </div>
    </div>

    <!-- Estimate Modal -->
    <div id="estimateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> New Estimate</h2>
                <button class="close-btn" onclick="closeEstimateModal()">&times;</button>
            </div>
            
            <form id="estimateForm" onsubmit="saveEstimate(event)">
                <div class="row">
                    <div class="half">
                        <div class="form-group">
                            <label>Customer Name *</label>
                            <input type="text" id="estCustomerName" required>
                        </div>
                    </div>
                    <div class="half">
                        <div class="form-group">
                            <label>Customer Phone *</label>
                            <input type="tel" id="estCustomerPhone" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="half">
                        <div class="form-group">
                            <label>Customer Email</label>
                            <input type="email" id="estCustomerEmail">
                        </div>
                    </div>
                    <div class="half">
                        <div class="form-group">
                            <label>Vehicle *</label>
                            <input type="text" id="estVehicle" placeholder="e.g., 2019 Toyota Camry" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Estimate Date *</label>
                    <input type="date" id="estDate" required>
                </div>

                <div class="line-items" id="estimateLineItems">
                    <h3>Line Items</h3>
                    <div class="line-item">
                        <div class="row">
                            <div class="half">
                                <input type="text" placeholder="Description" class="line-item-desc" value="Labor">
                            </div>
                            <div class="third">
                                <input type="number" placeholder="Hours" class="line-item-qty" value="1" step="0.5">
                            </div>
                            <div class="third">
                                <input type="number" placeholder="Rate" class="line-item-rate" value="100">
                            </div>
                        </div>
                        <div class="line-item-total">$100.00</div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="addEstimateLineItem()" style="margin-top: 10px;">
                    <i class="fas fa-plus"></i> Add Line Item
                </button>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="estNotes" rows="3" placeholder="Additional notes..."></textarea>
                </div>

                <div class="row" style="margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeEstimateModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-info" style="margin-left: 10px;">
                        <i class="fas fa-check"></i> Save Estimate
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice"></i> New Invoice</h2>
                <button class="close-btn" onclick="closeInvoiceModal()">&times;</button>
            </div>
            
            <form id="invoiceForm" onsubmit="saveInvoice(event)">
                <div class="row">
                    <div class="half">
                        <div class="form-group">
                            <label>Customer Name *</label>
                            <input type="text" id="invCustomerName" required>
                        </div>
                    </div>
                    <div class="half">
                        <div class="form-group">
                            <label>Customer Phone *</label>
                            <input type="tel" id="invCustomerPhone" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="half">
                        <div class="form-group">
                            <label>Customer Email</label>
                            <input type="email" id="invCustomerEmail">
                        </div>
                    </div>
                    <div class="half">
                        <div class="form-group">
                            <label>Vehicle *</label>
                            <input type="text" id="invVehicle" placeholder="e.g., 2019 Toyota Camry" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Invoice Date *</label>
                    <input type="date" id="invDate" required>
                </div>

                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="invDueDate">
                </div>

                <div class="line-items" id="invoiceLineItems">
                    <h3>Line Items</h3>
                    <div class="line-item">
                        <div class="row">
                            <div class="half">
                                <input type="text" placeholder="Description" class="line-item-desc" value="Labor">
                            </div>
                            <div class="third">
                                <input type="number" placeholder="Hours" class="line-item-qty" value="1" step="0.5">
                            </div>
                            <div class="third">
                                <input type="number" placeholder="Rate" class="line-item-rate" value="100">
                            </div>
                        </div>
                        <div class="line-item-total">$100.00</div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="addInvoiceLineItem()" style="margin-top: 10px;">
                    <i class="fas fa-plus"></i> Add Line Item
                </button>

                <div class="invoice-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="invSubtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (8%):</span>
                        <span id="invTax">$0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="invTotal">$0.00</span>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label>Payment Method</label>
                    <select id="invPaymentMethod">
                        <option value="">Select payment method...</option>
                        <option value="Cash">Cash</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Check">Check</option>
                        <option value="Finance">Finance</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="invNotes" rows="3" placeholder="Additional notes..."></textarea>
                </div>

                <div class="row" style="margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeInvoiceModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-success" style="margin-left: 10px;">
                        <i class="fas fa-check"></i> Save Invoice
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-plus"></i> New Appointment</h2>
                <button class="close-btn" onclick="closeAppointmentModal()">&times;</button>
            </div>
            
            <form id="appointmentForm" onsubmit="saveAppointment(event)">
                <div class="form-group">
                    <label>Customer Name *</label>
                    <input type="text" id="apptCustomerName" required>
                </div>

                <div class="form-group">
                    <label>Customer Phone *</label>
                    <input type="tel" id="apptCustomerPhone" required>
                </div>

                <div class="form-group">
                    <label>Customer Email</label>
                    <input type="email" id="apptCustomerEmail">
                </div>

                <div class="form-group">
                    <label>Vehicle *</label>
                    <input type="text" id="apptVehicle" placeholder="e.g., 2019 Toyota Camry" required>
                </div>

                <div class="row">
                    <div class="half">
                        <div class="form-group">
                            <label>Date *</label>
                            <input type="date" id="apptDate" required>
                        </div>
                    </div>
                    <div class="half">
                        <div class="form-group">
                            <label>Time *</label>
                            <input type="time" id="apptTime" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Service Needed *</label>
                    <select id="apptService" required>
                        <option value="">Select a service...</option>
                        <option value="Oil Change">Oil Change</option>
                        <option value="Brake Service">Brake Service</option>
                        <option value="Tire Rotation">Tire Rotation</option>
                        <option value="Engine Diagnostic">Engine Diagnostic</option>
                        <option value="AC Service">AC Service</option>
                        <option value="Battery Replacement">Battery Replacement</option>
                        <option value="Transmission Service">Transmission Service</option>
                        <option value="General Inspection">General Inspection</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Service Details</label>
                    <textarea id="apptNotes" rows="3" placeholder="Describe the issue or service needed..."></textarea>
                </div>

                <div class="row" style="margin-top: 20px;">
                    <button type="button" class="btn btn-danger" onclick="closeAppointmentModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" style="margin-left: 10px;">
                        <i class="fas fa-check"></i> Save Appointment
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Screen navigation
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // Add active class to clicked button
            if (event && event.target) {
                event.target.closest('.nav-btn').classList.add('active');
            }
            
            // Load data for specific screens
            if (screenId === 'estimatesScreen') {
                loadEstimates();
            }
            if (screenId === 'invoicesScreen') {
                loadInvoices();
            }
            if (screenId === 'appointmentsScreen') {
                loadAppointments();
            }
            if (screenId === 'techFlowScreen') {
                loadTechWorkflow();
            }
        }

        // Estimate Modal Functions
        function openEstimateModal() {
            document.getElementById('estimateModal').classList.add('active');
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('estDate').value = today;
        }

        function closeEstimateModal() {
            document.getElementById('estimateModal').classList.remove('active');
            document.getElementById('estimateForm').reset();
            
            // Reset line items to one empty item
            document.getElementById('estimateLineItems').innerHTML = `
                <h3>Line Items</h3>
                <div class="line-item">
                    <div class="row">
                        <div class="half">
                            <input type="text" placeholder="Description" class="line-item-desc" value="Labor">
                        </div>
                        <div class="third">
                            <input type="number" placeholder="Hours" class="line-item-qty" value="1" step="0.5">
                        </div>
                        <div class="third">
                            <input type="number" placeholder="Rate" class="line-item-rate" value="100">
                        </div>
                    </div>
                    <div class="line-item-total">$100.00</div>
                </div>
            `;
        }

        function addEstimateLineItem() {
            const container = document.getElementById('estimateLineItems');
            const newItem = document.createElement('div');
            newItem.className = 'line-item';
            newItem.innerHTML = `
                <div class="row">
                    <div class="half">
                        <input type="text" placeholder="Description" class="line-item-desc">
                    </div>
                    <div class="third">
                        <input type="number" placeholder="Hours" class="line-item-qty" step="0.5">
                    </div>
                    <div class="third">
                        <input type="number" placeholder="Rate" class="line-item-rate">
                    </div>
                </div>
                <div class="line-item-total">$0.00</div>
                <button type="button" class="btn btn-danger" onclick="this.closest('.line-item').remove()" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">
                    <i class="fas fa-trash"></i> Remove
                </button>
            `;
            container.appendChild(newItem);
        }

        // Invoice Modal Functions
        function openInvoiceModal() {
            document.getElementById('invoiceModal').classList.add('active');
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invDate').value = today;
        }

        function closeInvoiceModal() {
            document.getElementById('invoiceModal').classList.remove('active');
            document.getElementById('invoiceForm').reset();
            
            // Reset line items
            document.getElementById('invoiceLineItems').innerHTML = `
                <h3>Line Items</h3>
                <div class="line-item">
                    <div class="row">
                        <div class="half">
                            <input type="text" placeholder="Description" class="line-item-desc" value="Labor">
                        </div>
                        <div class="third">
                            <input type="number" placeholder="Hours" class="line-item-qty" value="1" step="0.5">
                        </div>
                        <div class="third">
                            <input type="number" placeholder="Rate" class="line-item-rate" value="100">
                        </div>
                    </div>
                    <div class="line-item-total">$100.00</div>
                </div>
            `;
            
            calculateInvoiceTotal();
        }

        function addInvoiceLineItem() {
            const container = document.getElementById('invoiceLineItems');
            const newItem = document.createElement('div');
            newItem.className = 'line-item';
            newItem.innerHTML = `
                <div class="row">
                    <div class="half">
                        <input type="text" placeholder="Description" class="line-item-desc">
                    </div>
                    <div class="third">
                        <input type="number" placeholder="Hours" class="line-item-qty" step="0.5">
                    </div>
                    <div class="third">
                        <input type="number" placeholder="Rate" class="line-item-rate">
                    </div>
                </div>
                <div class="line-item-total">$0.00</div>
                <button type="button" class="btn btn-danger" onclick="this.closest('.line-item').remove()" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">
                    <i class="fas fa-trash"></i> Remove
                </button>
            `;
            container.appendChild(newItem);
        }

        function calculateInvoiceTotal() {
            let subtotal = 0;
            const lineItems = document.querySelectorAll('#invoiceLineItems .line-item');
            
            lineItems.forEach(item => {
                const qty = parseFloat(item.querySelector('.line-item-qty').value) || 0;
                const rate = parseFloat(item.querySelector('.line-item-rate').value) || 0;
                const total = qty * rate;
                subtotal += total;
                item.querySelector('.line-item-total').textContent = '$' + total.toFixed(2);
            });
            
            const taxRate = 0.08;
            const tax = subtotal * taxRate;
            const total = subtotal + tax;
            
            document.getElementById('invSubtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('invTax').textContent = '$' + tax.toFixed(2);
            document.getElementById('invTotal').textContent = '$' + total.toFixed(2);
        }

        // Add event listeners for real-time calculation
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('input', function(e) {
                if (e.target.closest('#invoiceLineItems')) {
                    calculateInvoiceTotal();
                }
            });
        });

        // Save Estimate
        async function saveEstimate(event) {
            event.preventDefault();
            
            const lineItems = [];
            document.querySelectorAll('#estimateLineItems .line-item').forEach(item => {
                const desc = item.querySelector('.line-item-desc').value;
                const qty = parseFloat(item.querySelector('.line-item-qty').value) || 0;
                const rate = parseFloat(item.querySelector('.line-item-rate').value) || 0;
                if (desc) {
                    lineItems.push({ description: desc, quantity: qty, rate: rate, total: qty * rate });
                }
            });
            
            const total = lineItems.reduce((sum, item) => sum + item.total, 0);
            
            const estimate = {
                customerName: document.getElementById('estCustomerName').value,
                customerPhone: document.getElementById('estCustomerPhone').value,
                customerEmail: document.getElementById('estCustomerEmail').value,
                vehicle: document.getElementById('estVehicle').value,
                date: document.getElementById('estDate').value,
                lineItems: lineItems,
                total: total,
                notes: document.getElementById('estNotes').value,
                status: 'Pending'
            };
            
            // Save to localStorage for now
            let estimates = JSON.parse(localStorage.getItem('estimates') || '[]');
            estimate.id = 'EST-' + (estimates.length + 1).toString().padStart(4, '0');
            estimates.push(estimate);
            localStorage.setItem('estimates', JSON.stringify(estimates));
            
            alert('\u2705 Estimate saved successfully!');
            closeEstimateModal();
            loadEstimates();
        }

        // Save Invoice
        async function saveInvoice(event) {
            event.preventDefault();
            
            const lineItems = [];
            document.querySelectorAll('#invoiceLineItems .line-item').forEach(item => {
                const desc = item.querySelector('.line-item-desc').value;
                const qty = parseFloat(item.querySelector('.line-item-qty').value) || 0;
                const rate = parseFloat(item.querySelector('.line-item-rate').value) || 0;
                if (desc) {
                    lineItems.push({ description: desc, quantity: qty, rate: rate, total: qty * rate });
                }
            });
            
            const subtotal = lineItems.reduce((sum, item) => sum + item.total, 0);
            const taxRate = 0.08;
            const tax = subtotal * taxRate;
            const total = subtotal + tax;
            
            const invoice = {
                customerName: document.getElementById('invCustomerName').value,
                customerPhone: document.getElementById('invCustomerPhone').value,
                customerEmail: document.getElementById('invCustomerEmail').value,
                vehicle: document.getElementById('invVehicle').value,
                date: document.getElementById('invDate').value,
                dueDate: document.getElementById('invDueDate').value,
                lineItems: lineItems,
                subtotal: subtotal,
                tax: tax,
                total: total,
                paymentMethod: document.getElementById('invPaymentMethod').value,
                notes: document.getElementById('invNotes').value,
                status: 'Unpaid'
            };
            
            // Save to localStorage for now
            let invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
            invoice.id = 'INV-' + (invoices.length + 1).toString().padStart(4, '0');
            invoices.push(invoice);
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            alert('\u2705 Invoice saved successfully!');
            closeInvoiceModal();
            loadInvoices();
        }

        // Load Estimates
        function loadEstimates() {
            const estimates = JSON.parse(localStorage.getItem('estimates') || '[]');
            const tbody = document.getElementById('estimatesTable');
            
            if (estimates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #7f8c8d;">No estimates found</td></tr>';
                return;
            }
            
            tbody.innerHTML = estimates.map(est => `
                <tr>
                    <td><strong>${est.id}</strong></td>
                    <td>${new Date(est.date).toLocaleDateString()}</td>
                    <td>${est.customerName}</td>
                    <td>${est.vehicle}</td>
                    <td>$${est.total.toFixed(2)}</td>
                    <td><span class="status-badge ${est.status === 'Approved' ? 'success' : 'warning'}">${est.status}</span></td>
                    <td>
                        <button class="btn btn-success" style="padding: 5px 10px; font-size: 12px;" onclick="convertToInvoice('${est.id}')">
                            <i class="fas fa-file-invoice"></i>
                        </button>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteEstimate('${est.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Load Invoices
        function loadInvoices() {
            const invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
            const tbody = document.getElementById('invoicesTable');
            
            if (invoices.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #7f8c8d;">No invoices found</td></tr>';
                return;
            }
            
            tbody.innerHTML = invoices.map(inv => `
                <tr>
                    <td><strong>${inv.id}</strong></td>
                    <td>${new Date(inv.date).toLocaleDateString()}</td>
                    <td>${inv.customerName}</td>
                    <td>${inv.vehicle}</td>
                    <td>$${inv.total.toFixed(2)}</td>
                    <td><span class="status-badge ${inv.status === 'Paid' ? 'success' : 'warning'}">${inv.status}</span></td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;" onclick="printInvoice('${inv.id}')">
                            <i class="fas fa-print"></i>
                        </button>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteInvoice('${inv.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Convert Estimate to Invoice
        function convertToInvoice(estimateId) {
            const estimates = JSON.parse(localStorage.getItem('estimates') || '[]');
            const estimate = estimates.find(e => e.id === estimateId);
            
            if (!estimate) {
                alert('Estimate not found');
                return;
            }
            
            // Open invoice modal with estimate data
            openInvoiceModal();
            document.getElementById('invCustomerName').value = estimate.customerName;
            document.getElementById('invCustomerPhone').value = estimate.customerPhone;
            document.getElementById('invCustomerEmail').value = estimate.customerEmail || '';
            document.getElementById('invVehicle').value = estimate.vehicle;
            
            // Populate line items
            const container = document.getElementById('invoiceLineItems');
            container.innerHTML = '<h3>Line Items</h3>';
            
            estimate.lineItems.forEach(item => {
                const newItem = document.createElement('div');
                newItem.className = 'line-item';
                newItem.innerHTML = `
                    <div class="row">
                        <div class="half">
                            <input type="text" placeholder="Description" class="line-item-desc" value="${item.description}">
                        </div>
                        <div class="third">
                            <input type="number" placeholder="Hours" class="line-item-qty" value="${item.quantity}" step="0.5">
                        </div>
                        <div class="third">
                            <input type="number" placeholder="Rate" class="line-item-rate" value="${item.rate}">
                        </div>
                    </div>
                    <div class="line-item-total">$${item.total.toFixed(2)}</div>
                    <button type="button" class="btn btn-danger" onclick="this.closest('.line-item').remove()" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                `;
                container.appendChild(newItem);
            });
            
            calculateInvoiceTotal();
        }

        // Delete Estimate
        function deleteEstimate(estimateId) {
            if (!confirm('Are you sure you want to delete this estimate?')) return;
            
            let estimates = JSON.parse(localStorage.getItem('estimates') || '[]');
            estimates = estimates.filter(e => e.id !== estimateId);
            localStorage.setItem('estimates', JSON.stringify(estimates));
            
            alert('\u2705 Estimate deleted successfully!');
            loadEstimates();
        }

        // Delete Invoice
        function deleteInvoice(invoiceId) {
            if (!confirm('Are you sure you want to delete this invoice?')) return;
            
            let invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
            invoices = invoices.filter(i => i.id !== invoiceId);
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            alert('\u2705 Invoice deleted successfully!');
            loadInvoices();
        }

        // Print Invoice
        function printInvoice(invoiceId) {
            const invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
            const invoice = invoices.find(i => i.id === invoiceId);
            
            if (!invoice) {
                alert('Invoice not found');
                return;
            }
            
            // Create a simple print window
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Invoice ${invoice.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .header h1 { color: #2c3e50; }
                        .info { margin-bottom: 20px; }
                        .info p { margin: 5px 0; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background: #f8f9fa; }
                        .total { text-align: right; font-size: 18px; font-weight: bold; margin-top: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>\ud83d\ude97 VHICL Pro Auto Shop</h1>
                        <p>Invoice #${invoice.id}</p>
                    </div>
                    <div class="info">
                        <p><strong>Customer:</strong> ${invoice.customerName}</p>
                        <p><strong>Phone:</strong> ${invoice.customerPhone}</p>
                        <p><strong>Vehicle:</strong> ${invoice.vehicle}</p>
                        <p><strong>Date:</strong> ${new Date(invoice.date).toLocaleDateString()}</p>
                        ${invoice.dueDate ? `<p><strong>Due Date:</strong> ${new Date(invoice.dueDate).toLocaleDateString()}</p>` : ''}
                    </div>
                    <table>
                        <tr><th>Description</th><th>Hours</th><th>Rate</th><th>Total</th></tr>
                        ${invoice.lineItems.map(item => `
                            <tr>
                                <td>${item.description}</td>
                                <td>${item.quantity}</td>
                                <td>$${item.rate.toFixed(2)}</td>
                                <td>$${item.total.toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </table>
                    <div class="total">
                        <p>Subtotal: $${invoice.subtotal.toFixed(2)}</p>
                        <p>Tax: $${invoice.tax.toFixed(2)}</p>
                        <p>Total: $${invoice.total.toFixed(2)}</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Search functions
        function searchEstimates() {
            const searchTerm = document.getElementById('searchEstimates').value.toLowerCase();
            const rows = document.querySelectorAll('#estimatesTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function searchInvoices() {
            const searchTerm = document.getElementById('searchInvoices').value.toLowerCase();
            const rows = document.querySelectorAll('#invoicesTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Appointment Modal Functions
        function openAppointmentModal() {
            document.getElementById('appointmentModal').classList.add('active');
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('apptDate').value = today;
        }

        function closeAppointmentModal() {
            document.getElementById('appointmentModal').classList.remove('active');
            document.getElementById('appointmentForm').reset();
        }

        // Save Appointment
        async function saveAppointment(event) {
            event.preventDefault();
            
            const appointment = {
                customerName: document.getElementById('apptCustomerName').value,
                customerPhone: document.getElementById('apptCustomerPhone').value,
                customerEmail: document.getElementById('apptCustomerEmail').value,
                vehicle: document.getElementById('apptVehicle').value,
                date: document.getElementById('apptDate').value,
                time: document.getElementById('apptTime').value,
                service: document.getElementById('apptService').value,
                notes: document.getElementById('apptNotes').value,
                status: 'Scheduled'
            };
            
            let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            appointment.id = appointments.length + 1;
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            alert('\u2705 Appointment saved successfully!');
            closeAppointmentModal();
            loadAppointments();
        }

        // Load Appointments
        function loadAppointments() {
            const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            const tbody = document.getElementById('appointmentsTable');
            
            if (appointments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No appointments found</td></tr>';
                return;
            }
            
            tbody.innerHTML = appointments.map(apt => `
                <tr>
                    <td>
                        <strong>${new Date(apt.date).toLocaleDateString()}</strong><br>
                        <small>${apt.time}</small>
                    </td>
                    <td>${apt.customerName}</td>
                    <td>${apt.vehicle}</td>
                    <td>${apt.service}</td>
                    <td><span class="status-badge ${apt.status === 'Scheduled' ? 'success' : 'warning'}">${apt.status}</span></td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteAppointment('${apt.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteAppointment(id) {
            if (!confirm('Are you sure you want to delete this appointment?')) return;
            
            let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            appointments = appointments.filter(a => a.id !== id);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            alert('\u2705 Appointment deleted successfully!');
            loadAppointments();
        }

        function searchAppointments() {
            const searchTerm = document.getElementById('searchAppointments').value.toLowerCase();
            const rows = document.querySelectorAll('#appointmentsTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterAppointments() {
            const filter = document.getElementById('filterAppointments').value;
            alert('Filter by ' + filter + ' - coming soon');
        }

        // Tech Workflow
        async function loadTechWorkflow() {
            try {
                const response = await fetch('/api/tech/stats');
                const stats = await response.json();
                
                document.getElementById('techActiveJobs').textContent = stats.activeJobs;
                document.getElementById('techCompletedToday').textContent = stats.completedToday;
                document.getElementById('techTotalHours').textContent = stats.totalHours.toFixed(1);
                document.getElementById('techRating').textContent = stats.rating;
                
                loadTechActiveJobs();
                loadTechCompletedJobs();
            } catch (error) {
                console.error('Error loading tech workflow:', error);
            }
        }

        async function loadTechActiveJobs() {
            try {
                const response = await fetch('/api/tech/jobs/active');
                const data = await response.json();
                
                const tbody = document.getElementById('techActiveJobsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #7f8c8d;">No active jobs</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(job => `
                    <tr>
                        <td><strong>${job.id}</strong></td>
                        <td>${job.customerName || 'N/A'}</td>
                        <td>${job.vehicle || 'N/A'}</td>
                        <td>${job.service || 'N/A'}</td>
                        <td><span class="status-badge warning">Bay ${job.bay || 'TBD'}</span></td>
                        <td>${job.status === 'In Progress' ? '50%' : '0%'}</td>
                        <td>
                            <button class="btn btn-success" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-check"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading active jobs:', error);
            }
        }

        async function loadTechCompletedJobs() {
            try {
                const response = await fetch('/api/tech/jobs/completed');
                const data = await response.json();
                
                const tbody = document.getElementById('techCompletedJobsTable');
                
                if (!data || data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No completed jobs today</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.map(job => `
                    <tr>
                        <td><strong>${job.id}</strong></td>
                        <td>${job.customerName || 'N/A'}</td>
                        <td>${job.vehicle || 'N/A'}</td>
                        <td>${job.service || 'N/A'}</td>
                        <td>${job.hoursSpent || 0} hrs</td>
                        <td>${new Date(job.completedAt).toLocaleTimeString()}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading completed jobs:', error);
            }
        }

        // Settings
        function saveSettings() {
            const settings = {
                shopName: document.getElementById('settingShopName').value,
                phone: document.getElementById('settingPhone').value,
                email: document.getElementById('settingEmail').value,
                address: document.getElementById('settingAddress').value,
                laborRate: parseFloat(document.getElementById('settingLaborRate').value),
                taxRate: parseFloat(document.getElementById('settingTaxRate').value) / 100,
                diagnosticFee: parseFloat(document.getElementById('settingDiagnosticFee').value),
                vapiServerUrl: document.getElementById('settingServerUrl').value
            };
            
            localStorage.setItem('shopSettings', JSON.stringify(settings));
            
            alert('\u2705 Settings saved successfully!');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAppointments();
            loadTechWorkflow();
            loadEstimates();
            loadInvoices();
        });
    </script>
</body>
</html>
