<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Vehicle Diagnostic System</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e40af">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="vin-enhancements.css">
    <link rel="stylesheet" href="live-data-enhanced.css">
    <link rel="stylesheet" href="camera-vin-scanner.css">
    <link rel="stylesheet" href="battery-test.css">
    <link rel="stylesheet" href="readiness-monitors.css">
    <link rel="stylesheet" href="mode6-analyzer.css">
    <link rel="stylesheet" href="shop-settings.css">
    <link rel="stylesheet" href="smart-links.css">
    <link rel="stylesheet" href="performance-testing.css">
    <link rel="stylesheet" href="quote-builder.css">
    <link rel="stylesheet" href="photo-documentation.css">
    <link rel="stylesheet" href="customer-management.css">
    <link rel="stylesheet" href="service-advisor-tools.css">
    <link rel="stylesheet" href="help-system.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .screen {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .screen.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }
        
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mode-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .mode-card.selected {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .mode-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .mode-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 5px;
        }
        
        .mode-time {
            color: #64748b;
            font-size: 0.9em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: #475569;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #10b981;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }
        
        .btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            margin-top: 10px;
        }
        
        .status-box {
            background: #f1f5f9;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            line-height: 1.6;
        }
        
        .status-box.success {
            background: #d1fae5;
            border-left-color: #10b981;
        }
        
        .status-box.error {
            background: #fee2e2;
            border-left-color: #ef4444;
        }
        
        .timer {
            font-size: 3em;
            font-weight: bold;
            color: #10b981;
            text-align: center;
            margin: 30px 0;
        }
        
        .score-display {
            text-align: center;
            margin: 30px 0;
        }
        
        .score-number {
            font-size: 5em;
            font-weight: bold;
            color: #10b981;
            line-height: 1;
        }
        
        .score-rating {
            font-size: 1.5em;
            color: #64748b;
            margin-top: 10px;
        }
        
        .component-score {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .component-name {
            font-weight: bold;
            color: #1e40af;
        }
        
        .component-score-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #10b981;
        }
        
        .progress-bar {
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            height: 100%;
            transition: width 1s ease-out;
        }
        
        .issue-item {
            background: #fff7ed;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .issue-item.critical {
            background: #fee2e2;
            border-left-color: #ef4444;
        }
        
        .severity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .severity-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .severity-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        
        #obd2Status {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .btn, .button-group {
                display: none;
            }
            #vehicleDetails {
                display: block !important;
                border: 2px solid #1e40af;
                padding: 15px;
                margin: 20px 0;
                background: #f8fafc;
                border-radius: 8px;
            }
            #vehicleDetails div {
                margin: 8px 0;
                font-size: 14px;
            }
            /* Show decoded VIN details in print */
            #vehicleDetails + div {
                display: block !important;
                page-break-inside: avoid;
            }
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 2px solid #1e40af;
            }
        }
    /* Tablet Optimization (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            body {
                font-size: 18px;
            }
            
            .container {
                max-width: 95%;
                padding: 30px;
            }
            
            h1 {
                font-size: 42px;
            }
            
            h2 {
                font-size: 32px;
            }
            
            .btn {
                font-size: 20px;
                padding: 18px 32px;
                min-height: 60px;
            }
            
            input, select, textarea {
                font-size: 18px;
                padding: 16px;
                min-height: 56px;
            }
            
            .score-card {
                padding: 25px;
            }
            
            .status-box {
                font-size: 18px;
                padding: 20px;
            }
        }
        
        /* Large Tablet / Small Desktop (1024px+) */
        @media (min-width: 1024px) {
            .container {
                max-width: 1200px;
            }
            
            .score-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Landscape Tablet Optimization */
        @media (orientation: landscape) and (max-height: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 32px;
                margin-bottom: 15px;
            }
            
            h2 {
                font-size: 24px;
                margin-bottom: 15px;
            }
            
            .btn {
                padding: 12px 24px;
            }
        }
        
        /* Prevent text selection on buttons (professional look) */
        .btn, button {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Touch-friendly spacing */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                margin: 10px 0;
            }
            
            input, select, textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>

<link rel="stylesheet" href="tech-workflow.css">
    <link rel="stylesheet" href="customer-management.css">
    <link rel="stylesheet" href="vehicle-management.css">
    <link rel="stylesheet" href="customer-portal.css">
    <link rel="stylesheet" href="towing-integration.css">
    <link rel="stylesheet" href="appointment-booking.css">
    <link rel="stylesheet" href="photo-documentation.css">
</head>
<body>
    <!-- Update Banner -->
    <div id="updateBanner" style="display:none; position:fixed; top:0; left:0; right:0; 
         background:#2563eb; color:white; padding:15px; text-align:center; z-index:9999; 
         box-shadow:0 2px 10px rgba(0,0,0,0.2);">
        <strong>üîÑ New version available!</strong>
        <button onclick="updateApp()" style="margin-left:20px; padding:8px 20px; 
                background:white; color:#2563eb; border:none; border-radius:5px; 
                cursor:pointer; font-weight:bold; font-size:14px;">
            Update Now
        </button>
        <button onclick="dismissUpdate()" style="margin-left:10px; padding:8px 20px; 
                background:transparent; color:white; border:1px solid white; 
                border-radius:5px; cursor:pointer; font-size:14px;">
            Later
        </button>
    </div>
    <div class="container">
        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <div id="shopBranding" style="text-align:center; margin-bottom:20px;">
                <div id="shopLogo" style="display:none; margin-bottom:10px;">
                    <img id="shopLogoImg" src="" alt="Shop Logo" style="max-width:200px; max-height:80px;">
                </div>
                <h1 id="shopNameDisplay">üöó Professional Diagnostic System</h1>
                <p class="subtitle" id="shopTagline">Complete Vehicle Assessment &amp; Quote System</p>
            </div>
            
            <div class="status-box">
                <strong>System Features:</strong><br>
                ‚úÖ Professional OBD2 diagnostics<br>
                ‚úÖ AI-powered health scoring<br>
                ‚úÖ Complete vehicle assessment<br>
                ‚úÖ Quick quote generation<br>
                ‚úÖ Customer reports &amp; signatures<br><br>
                <strong>Note:</strong> OBD2 dongle required for vehicle assessments. Quick quotes can be created without a dongle.
            </div>
            
            <button class="btn" onclick="connectDongleFirst()">
                üöÄ Start Vehicle Assessment
            </button>
            
            <button class="btn" onclick="showQuickQuote()" style="background:#10b981; margin-top:10px;">
                üí∞ Quick Quote (No Dongle Needed)
            </button>
            
            <button class="btn" onclick="quickReadCodes()" style="background:#ef4444; margin-top:10px;">
                üö® Read Codes (Quick Scan)
            </button>
            
            <button class="btn" onclick="quickClearCodes()" style="background:#f59e0b; margin-top:10px;">
                üóëÔ∏è Clear Codes
            </button>
            
            <button class="btn" onclick="openReadinessMonitors()" style="background:#3b82f6; margin-top:10px;">
                üö¶ Readiness Monitors
            </button>
            
            <button class="btn" onclick="showLiveDataOptions()" style="background:#667eea; margin-top:10px;">
                üìä Live Data Monitor
            </button>
            
            <button class="btn" id="shopSettingsBtn" onclick="showShopSettings()" style="background:#6b7280; margin-top:10px; border: 3px solid red !important; min-height: 60px !important;">
                ‚öôÔ∏è SHOP SETTINGS (CLICK HERE)
            </button>
            
            <button class="btn" onclick="showCustomerManagement()" style="background:#8b5cf6; margin-top:10px;">
                üë• Customer Management
            </button>
            
            <button class="btn" onclick="showServiceAdvisor()" style="background:#f59e0b; margin-top:10px; position:relative;">
                üìÖ Service Advisor
                <span id="advisor-notification-badge" style="display:none; position:absolute; top:-5px; right:-5px; background:#dc2626; color:white; border-radius:50%; width:20px; height:20px; font-size:11px; display:flex; align-items:center; justify-content:center;"></span>
            </button>
               
               <button class="btn" onclick="showSalesReport()" style="background:#10b981; margin-top:10px;">
                   üìä Sales & Tax Reports
               </button>
            
        </div>
        
        <!-- Quick Quote Screen -->
        <div id="quickQuoteScreen" class="screen">
            <h2>üí∞ Quick Quote</h2>
            
            <div style="background:#eff6ff; padding:15px; border-radius:8px; margin-bottom:20px;">
                <strong>Fast Estimate Generator</strong><br>
                <small style="color:#64748b;">Generate professional quotes with integrated parts and labor lookup</small>
            </div>
            
            <div id="quickQuoteContent"></div>
            
            <button class="btn btn-secondary" onclick="showScreen('homeScreen')" style="margin-top:20px;">
                ‚Üê Back to Home
            </button>
        </div>
        
        <!-- Mode Selection Screen -->
        <div id="modeScreen" class="screen">
            <h2>Select Assessment Mode</h2>
            
            <div class="mode-grid">
                <div class="mode-card" onclick="selectMode('quick')">
                    <div class="mode-icon">‚ö°</div>
                    <div class="mode-title">Quick</div>
                    <div class="mode-time">2 minutes</div>
                </div>
                
                <div class="mode-card" onclick="selectMode('standard')">
                    <div class="mode-icon">‚úì</div>
                    <div class="mode-title">Standard</div>
                    <div class="mode-time">5 minutes</div>
                </div>
                
                <div class="mode-card" onclick="selectMode('full')">
                    <div class="mode-icon">üîç</div>
                    <div class="mode-title">Full</div>
                    <div class="mode-time">10 minutes</div>
                </div>
            </div>
        </div>
        
        <!-- Vehicle Info Screen -->
        <div id="infoScreen" class="screen">
            <h2>Step 2: Vehicle Information</h2>
            
            <div id="autoDetectedBanner" style="display: none; background: #d1fae5; color: #065f46; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                <strong>‚úÖ Auto-Detected from Vehicle!</strong><br>
                <span id="autoDetectedInfo"></span>
            </div>
            
            <div class="form-group">
                <label>VIN / License Plate *</label>
                <input type="text" id="vin" placeholder="Enter VIN or License Plate" required>
                <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                    <button type="button" class="btn" onclick="decodeVIN()" style="background: #059669; flex: 1; min-width: 200px;">
                        üîç Decode VIN (Auto-fill Vehicle Info)
                    </button>
                    <button type="button" class="btn" onclick="window.vinScanner.openCamera()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); flex: 1; min-width: 200px;">
                        üì∑ Scan VIN with Camera
                    </button>
                </div>
                <div id="vinDecodeStatus" style="margin-top: 10px; font-size: 14px; color: #64748b;"></div>
            </div>
            
            <div class="form-group">
                <label>Year *</label>
                <input type="number" id="year" placeholder="2020" required>
            </div>
            
            <div class="form-group">
                <label>Make *</label>
                <input type="text" id="make" placeholder="Toyota" required>
            </div>
            
            <div class="form-group">
                <label>Model *</label>
                <input type="text" id="model" placeholder="Camry" required>
            </div>
            
            <div class="form-group">
                <label>Mileage *</label>
                <input type="number" id="mileage" placeholder="50000" required>
            </div>
            
            <div class="form-group">
                <label>Engine Size (Liters)</label>
                <input type="text" id="engineSize" placeholder="2.4" style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px;">
                <small id="engineSizeHelp" style="color: #10b981; display: block; margin-top: 5px;">
                    ‚úÖ Decoded from VIN 8th digit (accurate)
                </small>
            </div>
            
            <div class="form-group">
                <label>Engine Type</label>
                <select id="engineType" style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px;">
                    <option value="">Select engine type</option>
                    <option value="I3">Inline 3-Cylinder (I3)</option>
                    <option value="I4">Inline 4-Cylinder (I4)</option>
                    <option value="I5">Inline 5-Cylinder (I5)</option>
                    <option value="I6">Inline 6-Cylinder (I6)</option>
                    <option value="V6">V6</option>
                    <option value="V8">V8</option>
                    <option value="V10">V10</option>
                    <option value="V12">V12</option>
                    <option value="W12">W12</option>
                    <option value="Rotary">Rotary</option>
                    <option value="Electric">Electric</option>
                    <option value="Hybrid">Hybrid</option>
                </select>
                <small id="engineTypeHelp" style="color: #10b981; display: block; margin-top: 5px;">
                    ‚úÖ Decoded from VIN 8th digit (accurate)
                </small>
            </div>
            
            <div class="form-group">
                <label>Vehicle Type</label>
                <select id="vehicleType" style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px;">
                    <option value="standard">Standard (Sedan/Coupe/Hatchback)</option>
                    <option value="convertible">Convertible</option>
                    <option value="suv">SUV/Truck</option>
                    <option value="sports">Sports Car</option>
                    <option value="luxury">Luxury Vehicle</option>
                </select>
                <small style="color: #64748b; display: block; margin-top: 5px;">
                    Convertibles and sports cars have adjusted scoring expectations
                </small>
            </div>
            
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="isModified" style="width: 20px; height: 20px; cursor: pointer;">
                    <span>Vehicle has performance modifications or aftermarket parts</span>
                </label>
                <small style="color: #64748b; display: block; margin-top: 5px; margin-left: 30px;">
                    Check this if vehicle has: turbo/supercharger, exhaust mods, ECU tune, suspension mods, etc.
                </small>
            </div>
            
            <div class="form-group">
                <label>Customer Name</label>
                <input type="text" id="customerName" placeholder="John Doe">
            </div>
            
            <div class="form-group">
                <label>Notes</label>
                <textarea id="notes" placeholder="Additional notes..."></textarea>
            </div>
            
            <button class="btn" onclick="startAssessment()">
                ‚ñ∂Ô∏è Start Assessment
            </button>
        </div>
        
        <!-- Dashboard Warning Lights Check Screen -->
        <div id="dashboardLightsScreen" class="screen">
            <h2>‚ö†Ô∏è Dashboard Warning Lights Check</h2>
            
            <div class="status-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; color: #92400e; margin-bottom: 20px;">
                <strong>üö® IMPORTANT:</strong> Before we scan, please check your dashboard.<br>
                Are any of these warning lights ON?
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="color: #1e40af; margin-top: 0;">Warning Lights Status:</h3>
                
                <div style="display: grid; gap: 15px;">
                    <!-- Check Engine Light -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 32px;">üîß</span>
                            <div>
                                <strong style="font-size: 18px;">Check Engine Light (CEL)</strong><br>
                                <small style="color: #64748b;">Engine/emissions system warning</small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="setWarningLight('cel', true)" style="background: #ef4444; padding: 10px 20px; min-width: 80px;">YES</button>
                            <button class="btn" onclick="setWarningLight('cel', false)" style="background: #10b981; padding: 10px 20px; min-width: 80px;">NO</button>
                        </div>
                    </div>
                    
                    <!-- ABS Light -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 32px;">üõë</span>
                            <div>
                                <strong style="font-size: 18px;">ABS Light</strong><br>
                                <small style="color: #64748b;">Anti-lock brake system warning</small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="setWarningLight('abs', true)" style="background: #ef4444; padding: 10px 20px; min-width: 80px;">YES</button>
                            <button class="btn" onclick="setWarningLight('abs', false)" style="background: #10b981; padding: 10px 20px; min-width: 80px;">NO</button>
                        </div>
                    </div>
                    
                    <!-- SRS/Airbag Light -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 32px;">üéà</span>
                            <div>
                                <strong style="font-size: 18px;">SRS/Airbag Light</strong><br>
                                <small style="color: #64748b;">Airbag system warning</small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="setWarningLight('srs', true)" style="background: #ef4444; padding: 10px 20px; min-width: 80px;">YES</button>
                            <button class="btn" onclick="setWarningLight('srs', false)" style="background: #10b981; padding: 10px 20px; min-width: 80px;">NO</button>
                        </div>
                    </div>
                    
                    <!-- TPMS Light -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 32px;">üõû</span>
                            <div>
                                <strong style="font-size: 18px;">TPMS Light</strong><br>
                                <small style="color: #64748b;">Tire pressure monitoring system</small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="setWarningLight('tpms', true)" style="background: #ef4444; padding: 10px 20px; min-width: 80px;">YES</button>
                            <button class="btn" onclick="setWarningLight('tpms', false)" style="background: #10b981; padding: 10px 20px; min-width: 80px;">NO</button>
                        </div>
                    </div>
                    
                    <!-- Brake Warning Light -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 32px;">üö®</span>
                            <div>
                                <strong style="font-size: 18px;">Brake Warning Light</strong><br>
                                <small style="color: #64748b;">Brake system/parking brake warning</small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="setWarningLight('brake', true)" style="background: #ef4444; padding: 10px 20px; min-width: 80px;">YES</button>
                            <button class="btn" onclick="setWarningLight('brake', false)" style="background: #10b981; padding: 10px 20px; min-width: 80px;">NO</button>
                        </div>
                    </div>
                    
                    <!-- Battery/Charging Light -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 32px;">üîã</span>
                            <div>
                                <strong style="font-size: 18px;">Battery/Charging Light</strong><br>
                                <small style="color: #64748b;">Charging system warning</small>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="setWarningLight('battery', true)" style="background: #ef4444; padding: 10px 20px; min-width: 80px;">YES</button>
                            <button class="btn" onclick="setWarningLight('battery', false)" style="background: #10b981; padding: 10px 20px; min-width: 80px;">NO</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="warningLightsSummary" style="display: none; background: #fee2e2; border: 2px solid #ef4444; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong style="color: #991b1b;">‚ö†Ô∏è Warning Lights Detected:</strong>
                <ul id="warningLightsList" style="margin: 10px 0; color: #991b1b;"></ul>
                <p style="margin: 0; color: #991b1b;"><strong>These will affect your vehicle's score.</strong></p>
            </div>
            
            <button class="btn" id="proceedFromLightsBtn" onclick="proceedFromDashboardCheck()" disabled style="opacity: 0.5;">
                ‚úÖ Continue to Diagnostic Scan
            </button>
            
            <p style="text-align: center; color: #64748b; margin-top: 15px;">
                <small>Please answer all questions to continue</small>
            </p>
        </div>
        
        <!-- Connection Choice Screen -->
        <div id="connectionChoiceScreen" class="screen">
            <h2>üîó OBD2 Connection</h2>
            
            <div class="status-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; color: #92400e; margin-bottom: 30px;">
                <strong>‚ö†Ô∏è Choose How to Proceed:</strong><br>
                Connect your OBD2 dongle for automatic diagnostics, or continue manually if you're having connection issues.
            </div>
            
            <div style="display: grid; gap: 20px; margin-bottom: 30px;">
                <!-- Connect Dongle Option -->
                <div style="background: white; padding: 25px; border-radius: 12px; border: 3px solid #10b981; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <div style="font-size: 48px; text-align: center; margin-bottom: 15px;">üîó</div>
                    <h3 style="margin: 0 0 10px 0; color: #10b981; text-align: center;">Connect OBD2 Dongle</h3>
                    <p style="color: #64748b; text-align: center; margin-bottom: 20px;">
                        Automatic VIN reading, code scanning, and live data monitoring
                    </p>
                    <button class="btn" onclick="chooseConnectDongle()" style="width: 100%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); font-size: 18px; padding: 15px;">
                        ‚úÖ Connect Dongle (Recommended)
                    </button>
                </div>
                
                <!-- Manual Mode Option -->
                <div style="background: white; padding: 25px; border-radius: 12px; border: 3px solid #f59e0b; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <div style="font-size: 48px; text-align: center; margin-bottom: 15px;">üìù</div>
                    <h3 style="margin: 0 0 10px 0; color: #f59e0b; text-align: center;">Continue Without Dongle</h3>
                    <p style="color: #64748b; text-align: center; margin-bottom: 20px;">
                        Manual assessment using phone sensors only (limited diagnostics)
                    </p>
                    <button class="btn" onclick="chooseManualMode()" style="width: 100%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); font-size: 18px; padding: 15px;">
                        ‚ö†Ô∏è Manual Mode (Backup)
                    </button>
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; color: #64748b; font-size: 14px;">
                <strong>üí° Tip:</strong> Use manual mode if you're having dongle connection issues or demonstrating the system without a vehicle.
            </div>
        </div>
        
        <!-- Connection Screen -->
        <div id="connectScreen" class="screen">
            <h2>Step 1: Connect OBD2 Dongle</h2>
            
            <div class="status-box" style="margin-bottom: 20px;">
                <strong>üì± Instructions:</strong><br>
                1. Plug OBD2 dongle into vehicle's port (usually under dashboard)<br>
                2. Turn vehicle ignition to ON (engine can be off)<br>
                3. Click the button below to pair with dongle<br>
                4. We'll automatically read the VIN and vehicle details
            </div>
            
            <div id="connectionStatus" class="status-box">
                Ready to connect...
            </div>
            
            <!-- VIN Enhancements Container -->
            <div id="vin-enhancements" class="vin-enhancements"></div>
            
            <button class="btn" id="connectDongleBtn" onclick="startDongleConnection()">
                üîó Connect to OBD2 Dongle
            </button>
        </div>
        
        <!-- Test Drive Screen -->
        <div id="testDriveScreen" class="screen">
            <h2>Test Drive Assessment</h2>
            
            <div id="testDriveStatus" class="status-box">
                Initializing sensors...
            </div>
            
            <div class="timer" id="testDriveTimer">0:00</div>
            
            <!-- Live Data Widget Removed - Use "üìä Live Data Monitor" button from home screen instead -->
               
            <!-- Built-in Debug Console -->
            <div id="debugConsole" style="margin: 20px 0; padding: 15px; background: #1e293b; color: #10b981; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 200px; overflow-y: auto; border: 2px solid #10b981;">
                <div style="color: #60a5fa; font-weight: bold; margin-bottom: 10px;">üìä LIVE DEBUG CONSOLE</div>
                <div id="debugLog">Waiting for sensor data...</div>
            </div>
            
            <button class="btn" onclick="completeTestDrive()" disabled>
                ‚è±Ô∏è Complete Test Drive (60s minimum)
            </button>
        </div>
        
        <!-- Results Screen -->
        <div id="resultsScreen" class="screen">
            <h2>Assessment Results</h2>
            
            <div style="text-align: center; color: #64748b; margin-bottom: 20px;">
                <strong id="vehicleInfo"></strong>
            </div>
            
            <div id="vehicleDetails" style="text-align: center; color: #64748b; margin-bottom: 20px; font-size: 14px;">
                <div><strong>VIN/License Plate:</strong> <span id="vinDisplay">N/A</span></div>
                <div><strong>Mileage:</strong> <span id="mileageDisplay">N/A</span></div>
                <div><strong>Customer:</strong> <span id="customerDisplay">N/A</span></div>
            </div>
            
            <div id="obd2Status" style="display: none;"></div>
            
            <div class="score-display">
                <div class="score-number" id="overallScore">0</div>
                <div class="score-rating" id="overallRating">Calculating...</div>
            </div>
            
            <!-- Component Scores Section - Hidden for now -->
               <div style="display: none;">
               <h3 style="color: #1e40af; margin: 30px 0 20px 0;">Component Scores</h3>
               
               <!-- Professional Gauge Charts -->
               <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px 0;">
                   <div style="text-align: center;">
                       <canvas id="engineChart" width="150" height="150"></canvas>
                       <div style="margin-top: 10px; font-weight: 600;">üîß Engine Health</div>
                       <div id="engineScore" style="font-size: 24px; font-weight: bold; color: #1e40af;">0</div>
                   </div>
                   <div style="text-align: center;">
                       <canvas id="transmissionChart" width="150" height="150"></canvas>
                       <div style="margin-top: 10px; font-weight: 600;">‚öôÔ∏è Drivetrain</div>
                       <div id="transmissionScore" style="font-size: 24px; font-weight: bold; color: #1e40af;">0</div>
                   </div>
                   <div style="text-align: center;">
                       <canvas id="suspensionChart" width="150" height="150"></canvas>
                       <div style="margin-top: 10px; font-weight: 600;">üöó Suspension</div>
                       <div id="suspensionScore" style="font-size: 24px; font-weight: bold; color: #1e40af;">0</div>
                   </div>
                   <div style="text-align: center;">
                       <canvas id="brakesChart" width="150" height="150"></canvas>
                       <div style="margin-top: 10px; font-weight: 600;">üõë Brakes</div>
                       <div id="brakesScore" style="font-size: 24px; font-weight: bold; color: #1e40af;">0</div>
                   </div>
               </div>
               </div>
               
               <h3 style="color: #1e40af; margin: 30px 0 20px 0;">Issues Detected</h3>
            <div id="issuesList"></div>
            
            <!-- Professional Scoring Info -->
            <div id="repairEstimate" style="display: none;"></div>
            <div id="mileageAdjustmentInfo" style="display: none;"></div>
            <div id="dataQuality" style="display: none;"></div>
            
            <!-- AI Comparison Section -->
            <div id="aiComparisonSection" style="display: none; margin: 30px 0;">
                <h3 style="color: #1e40af; margin: 20px 0;">ü§ñ AI Vehicle Comparison</h3>
                
                <div id="aiInsights" style="margin: 20px 0;"></div>
                
                <div id="aiStatistics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;"></div>
                
                <div id="aiRecommendations" style="margin: 20px 0;"></div>
                
                <div id="aiCommonIssues" style="margin: 20px 0;"></div>
            </div>
            
            <!-- AI OBD Data Inspection Button -->
            <div style="margin: 30px 0; padding: 20px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 12px;">
                <h3 style="color: white; margin: 0 0 10px 0;">ü§ñ AI OBD Data Inspection</h3>
                <p style="color: rgba(255,255,255,0.9); margin: 0 0 15px 0; font-size: 14px;">
                    Get AI-powered analysis of all collected diagnostic data, codes, and sensor readings
                </p>
                <button class="btn" onclick="runAIInspection()" style="background: white; color: #8b5cf6; font-weight: bold;">
                    ü§ñ Analyze with AI
                </button>
            </div>
            
            <!-- Social Media Share Button -->
            <div style="margin: 30px 0; padding: 20px; background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); border-radius: 12px;">
                <h3 style="color: white; margin: 0 0 10px 0;">üì± Share Your Health Score</h3>
                <p style="color: rgba(255,255,255,0.9); margin: 0 0 15px 0; font-size: 14px;">
                    Let your customers brag about their vehicle's health score on social media! Generates Instagram, Facebook, and Story graphics.
                </p>
                <button class="btn" onclick="generateSocialShare()" style="background: white; color: #ec4899; font-weight: bold;">
                    üì± Create Social Media Post
                </button>
            </div>
            
            <div class="button-group">
                <button class="btn" onclick="saveAsInitial()">
                    üíæ Save as Initial
                </button>
                <button class="btn" onclick="compareWithInitial()">
                    üìä Compare with Initial
                </button>
            </div>
            
            <div class="button-group">
                <button class="btn" onclick="showPerformanceTests()" style="background: #f59e0b;">
                    üèÅ Performance Testing
                </button>
                <button class="btn" onclick="showBiDirectionalControls()" style="background: #059669;">
                    üéÆ Bi-Directional Controls
                </button>
                <!-- Live Data Widget removed - use "üìä Live Data Monitor" from home screen instead -->
                <button class="btn" onclick="window.photoDoc.showPhotoScreen()" style="background: #8b5cf6;">
                    üì∏ Photo Documentation
                </button>
            </div>
            
            <!-- Export buttons removed - non-functional -->
            
            <div class="button-group">
                <button class="btn" onclick="emailReport()">
                    üìß Email Report
                </button>
                <button class="btn" onclick="printReport()">
                    üñ®Ô∏è Print Report
                </button>
            </div>
            
            <button class="btn btn-secondary" onclick="startNewAssessment()">
                üîÑ New Assessment
            </button>
        </div>
    </div>
    
        <!-- Performance Testing Screen -->
        <div id="performanceScreen" class="screen">
            <h2>üèÅ Performance Testing</h2>
            
            <div class="performance-test-menu">
                <div class="performance-test-card">
                    <div class="test-card-icon">üöÄ</div>
                    <h3>0-60 MPH Test</h3>
                    <p>Measure acceleration time from 0 to 60 MPH. Requires OBD2 connection for speed data.</p>
                    <button class="btn" onclick="start060Test()">
                        Start Test
                    </button>
                </div>
                
                <div class="performance-test-card">
                    <div class="test-card-icon">üõë</div>
                    <h3>Braking Test</h3>
                    <p>Measure stopping distance from 60 to 0 MPH. Tests brake performance and safety.</p>
                    <button class="btn" onclick="startBrakingTest()">
                        Start Test
                    </button>
                </div>
                
                <div class="performance-test-card">
                    <div class="test-card-icon">üìä</div>
                    <h3>G-Force Monitor</h3>
                    <p>Real-time monitoring of acceleration, braking, and cornering forces.</p>
                    <button class="btn" onclick="startGForceMonitor()">
                        Start Monitor
                    </button>
                </div>
            </div>
            
            <div id="performanceTestArea"></div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="showScreen('resultsScreen')">
                    üîô Back to Results
                </button>
            </div>
        </div>
        
        <!-- Bi-Directional Controls Screen -->
        <div id="biDirectionalScreen" class="screen">
            <h2>üéÆ Bi-Directional Controls</h2>
            
            <div class="status-box" style="background: #fef3c7; color: #92400e; margin-bottom: 20px;">
                <strong>‚ö†Ô∏è Warning:</strong> These tests control vehicle components. Only use with engine running and vehicle in safe location.
            </div>
            
            <!-- Read Codes Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #ef4444;">üö® Read Diagnostic Codes</h3>
                <button class="btn" onclick="readCodesOnly()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    üö® Read Codes (Quick Scan)
                </button>
                <p style="font-size: 14px; color: #64748b; margin-top: 10px;">
                    <strong>Quick Code Reading:</strong> Read stored, pending, and permanent DTCs without full assessment
                </p>
            </div>
            
            <!-- Mode 6 Test Results Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #8b5cf6;">üîÆ Mode 6 - Component Test Results</h3>
                <button class="btn" onclick="openMode6Analyzer()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    üîÆ Analyze Component Health
                </button>
                <p style="font-size: 14px; color: #64748b; margin-top: 10px;">
                    <strong>The "Crystal Ball"</strong> - Shows component test results BEFORE they fail ‚Ä¢ Predicts future failures
                </p>
            </div>
            
            <!-- Emissions Readiness Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #1e40af;">üö¶ Emissions Readiness Check</h3>
                <button class="btn" onclick="openReadinessMonitors()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    üö¶ Check Readiness Monitors
                </button>
                <p style="font-size: 14px; color: #64748b; margin-top: 10px;">
                    Check if vehicle is ready for emissions testing ‚Ä¢ Shows drive cycle requirements
                </p>
            </div>
            
            <!-- Battery Test Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #1e40af;">üîã Battery &amp; Charging System Test</h3>
                <button class="btn" onclick="openBatteryTest()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    ‚ö° Test Battery &amp; Alternator
                </button>
                <p style="font-size: 14px; color: #64748b; margin-top: 10px;">
                    Quick voltage check or comprehensive battery &amp; charging system analysis
                </p>
            </div>
            
            <!-- Live Data Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #1e40af;">üìä Live Data Monitor</h3>
                <button class="btn" onclick="window.open('live-data-advanced.html', '_blank')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    üöÄ Advanced Live Data (100+ PIDs - With Graphs)
                </button>
                <button class="btn" onclick="window.open('live-data-simple.html', '_blank')" style="margin-left: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    üìã Simple Live Data (No Graphs - Fast)
                </button>
                <p style="font-size: 14px; color: #64748b; margin-top: 10px;">
                    <strong>Advanced:</strong> Select any PIDs, real-time graphs, CSV export<br>
                    <strong>Simple:</strong> Quick view of all PIDs, no graphs, faster updates
                </p>
            </div>
            
            <!-- AI OBD Data Inspection - Restored -->
            <div style="margin: 20px 0;">
                <h3 style="color: #8b5cf6;">ü§ñ AI OBD Data Inspection</h3>
                <button class="btn" onclick="runAIInspection()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    ü§ñ AI Analyze OBD Data
                </button>
                <p style="font-size: 14px; color: #64748b; margin-top: 10px;">
                    <strong>AI Intelligence:</strong> Analyzes collected OBD data, diagnostic codes, and sensor readings<br>
                    ‚Ä¢ Identifies hidden problems and patterns<br>
                    ‚Ä¢ Provides detailed diagnosis with confidence scores<br>
                    ‚Ä¢ Recommends repairs and estimates severity
                </p>
            </div>
            
            <!-- Actuator Tests Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #1e40af;">üîß Actuator Tests</h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <button class="btn" onclick="runActuatorTest('evap')" style="background: #059669;">
                        üí® EVAP System
                    </button>
                    <button class="btn" onclick="runActuatorTest('o2heater')" style="background: #059669;">
                        üî• O2 Heater
                    </button>
                    <button class="btn" onclick="runActuatorTest('egr')" style="background: #059669;">
                        ‚ôªÔ∏è EGR Valve
                    </button>
                    <button class="btn" onclick="runActuatorTest('fuelpump')" style="background: #059669;">
                        ‚õΩ Fuel Pump
                    </button>
                    <button class="btn" onclick="runActuatorTest('ac')" style="background: #059669;">
                        ‚ùÑÔ∏è A/C Compressor
                    </button>
                    <button class="btn" onclick="runActuatorTest('air')" style="background: #059669;">
                        üí® Secondary Air
                    </button>
                    <button class="btn" onclick="runActuatorTest('purge')" style="background: #059669;">
                        üö∞ Purge Valve
                    </button>
                </div>
                
                <div id="actuatorResult" style="margin-top: 15px; padding: 15px; background: #f1f5f9; border-radius: 8px; display: none;"></div>
            </div>
            
            <!-- Advanced Diagnostics Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #1e40af;">üîç Advanced Diagnostics</h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <button class="btn" onclick="getPendingCodes()">
                        ‚è≥ Pending Codes
                    </button>
                    <button class="btn" onclick="getPermanentCodes()">
                        üîí Permanent Codes
                    </button>
                    <button class="btn" onclick="getTestResults()">
                        üìä Test Results
                    </button>
                    <button class="btn" onclick="getFreezeFrame()">
                        ‚ùÑÔ∏è Freeze Frame
                    </button>
                </div>
                
                <div id="advancedDiagResult" style="margin-top: 15px; padding: 15px; background: #f1f5f9; border-radius: 8px; display: none;"></div>
            </div>
            
            <!-- Clear Codes Section -->
            <div style="margin: 20px 0;">
                <h3 style="color: #dc2626;">üóëÔ∏è Clear Diagnostic Codes</h3>
                
                <div class="status-box" style="background: #fee2e2; color: #991b1b;">
                    <strong>‚ö†Ô∏è CRITICAL WARNING:</strong> Clearing codes will:<br>
                    ‚Ä¢ Erase freeze frame data<br>
                    ‚Ä¢ Reset ALL readiness monitors to "Not Ready"<br>
                    ‚Ä¢ Require 30-50 miles of driving to reset monitors<br>
                    ‚Ä¢ Vehicle will FAIL emissions test until monitors are ready<br>
                    <br>
                    <strong>DO NOT clear codes before emissions testing!</strong><br>
                    Only clear after repairs are complete.
                </div>
                
                <button class="btn" onclick="confirmClearCodes()" style="background: #dc2626; margin-top: 10px;">
                    üóëÔ∏è Clear All Codes
                </button>
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="showScreen('resultsScreen')">
                    ‚Üê Back to Results
                </button>
            </div>
        </div>
        
        <!-- Shop Settings Screen -->
        <div id="shopSettingsScreen" class="screen">
            <h2>‚öôÔ∏è Shop Settings</h2>
            
            <div style="background:white; padding:20px; border-radius:10px; margin:20px 0;">
                <h3 style="margin-top:0;">Shop Information</h3>
                
                <label style="display:block; margin:15px 0;">
                    <strong>Shop Name:</strong><br>
                    <input type="text" id="shopNameInput" placeholder="Enter shop name" 
                           style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px;">
                </label>
                
                <label style="display:block; margin:15px 0;">
                    <strong>Tagline/Slogan:</strong><br>
                    <input type="text" id="shopTaglineInput" placeholder="e.g., Your Trusted Auto Repair" 
                           style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px;">
                </label>
                
                <label style="display:block; margin:15px 0;">
                    <strong>Phone:</strong><br>
                    <input type="tel" id="shopPhoneInput" placeholder="(555) 123-4567" 
                           style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px;">
                </label>
                
                <label style="display:block; margin:15px 0;">
                    <strong>Email:</strong><br>
                    <input type="email" id="shopEmailInput" placeholder="shop@example.com" 
                           style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px;">
                </label>
                
                <label style="display:block; margin:15px 0;">
                    <strong>Address:</strong><br>
                    <textarea id="shopAddressInput" placeholder="123 Main St, City, State ZIP" 
                              style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px; min-height:60px;"></textarea>
                </label>
                
                <label style="display:block; margin:15px 0;">
                    <strong>Logo URL:</strong><br>
                    <input type="url" id="shopLogoInput" placeholder="https://example.com/logo.png" 
                           style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:5px;">
                    <small style="color:#666;">Enter a URL to your shop logo image</small>
                </label>
                
                <button class="btn" onclick="saveShopBasicInfo()" style="width:100%; margin-top:20px;">
                    üíæ Save Shop Information
                </button>
            </div>
            
            <div style="background:#fef3c7; padding:20px; border-radius:10px; margin:20px 0; border-left:4px solid #f59e0b;">
                <h3 style="margin-top:0; color:#92400e;">üí∞ Advanced Settings</h3>
                <p style="color:#92400e; margin-bottom:15px;">
                    Configure pricing, labor rates, parts markup, Nexpart credentials, and more.
                </p>
                <button class="btn" onclick="console.log('üî¥ BUTTON CLICKED!'); console.log('üîç Function exists?', typeof window.showShopSettings); try { window.showShopSettings(); console.log('‚úÖ Function executed'); } catch(e) { console.error('‚ùå ERROR:', e); alert('Error: ' + e.message); }" style="width:100%; background:#f59e0b;">
                    ‚öôÔ∏è Open Advanced Settings (Pricing, Credentials, etc.)
                </button>
            </div>
            
            <button class="btn btn-secondary" onclick="showScreen('homeScreen')">
                ‚Üê Back to Home
            </button>
        </div>
    </div>

    <script src="obd2-reader-imperial.js"></script>
    <script src="connection-diagnostic.js"></script>
    <script src="readVIN-FIXED.js"></script>
    <script src="quick-test.js"></script>
    <script src="discover-services.js"></script>
    <script src="konnwei-handler.js"></script>
    <script src="konnwei-debugger.js"></script>
    <script src="ai-comparison.js"></script>
    <script src="bidirectional-controls.js"></script>
    <script src="obd2-scoring-engine.js"></script>
    <script src="fast-obd2-scoring.js"></script>
    
   <script src="live-data-launcher.js"></script>
   <script src="engine-decoder.js"></script>
   <script src="parts-matrix.js"></script>
   <script src="invoice-system.js"></script>
   <script src="sales-reports.js"></script>
   <script src="app-fixed.js"></script>
    <script src="bidirectional-ui.js"></script>
    
    <!-- Fix for missing functions -->
    <script>
        // Wrapper function for showScreen - makes it globally available
        function showScreen(screenId) {
            // Try to find the function in app-fixed.js or other loaded scripts
            if (typeof window.showScreen === 'function') {
                window.showScreen(screenId);
            } else {
                // Fallback implementation
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                const screen = document.getElementById(screenId);
                if (screen) {
                    screen.classList.add('active');
                    console.log('üì± Showing screen:', screenId);
                } else {
                    console.error('‚ùå Screen not found:', screenId);
                }
            }
        }
        
        // Wrapper function for generateSocialShare - makes it globally available
        function generateSocialShare() {
            if (window.socialShareGenerator && typeof window.socialShareGenerator.showShareModal === 'function') {
                window.socialShareGenerator.showShareModal();
            } else {
                console.error('‚ùå Social share generator not available');
                alert('Social media sharing is currently unavailable. Please try again later.');
            }
        }
    </script>
    
    <!-- Fix for missing functions -->
    <script>
        // Global function for showScreen - ensures it's available for onclick handlers
        window.showScreen = function(screenId) {
            console.log('üì± showScreen called with:', screenId);
            
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            const screen = document.getElementById(screenId);
            if (screen) {
                screen.classList.add('active');
                console.log('‚úÖ Showing screen:', screenId);
            } else {
                console.error('‚ùå Screen not found:', screenId);
            }
        };
        
        // Global function for generateSocialShare - ensures it's available for onclick handlers
        window.generateSocialShare = function() {
            console.log('üì± generateSocialShare called');
            
            if (window.socialShareGenerator && typeof window.socialShareGenerator.showShareModal === 'function') {
                // Get current assessment data
                const assessmentData = {
                    healthScore: parseInt(document.getElementById('overallScore')?.textContent) || 0,
                    vehicleInfo: document.getElementById('vehicleInfo')?.textContent || 'Unknown Vehicle',
                    vin: document.getElementById('vinDisplay')?.textContent || 'N/A',
                    mileage: document.getElementById('mileageDisplay')?.textContent || 'N/A',
                    customer: document.getElementById('customerDisplay')?.textContent || 'N/A'
                };
                
                window.socialShareGenerator.showShareModal(assessmentData);
            } else {
                console.error('‚ùå Social share generator not available');
                alert('Social media sharing is currently unavailable. Please try again later.');
            }
        };
        
        console.log('‚úÖ Global functions loaded: showScreen, generateSocialShare');
    </script>
    <script src="vin-enhancements.js"></script>
    <!-- <script src="live-data-enhanced.js"></script> -->
    <script src="live-data-enhanced-v2.js"></script>
    <script src="shop-settings.js"></script>
    <script src="smart-links.js"></script>
    <script src="performance-testing.js"></script>
    <script src="quote-builder.js"></script>
    <script src="quote-pdf-generator.js"></script>
    <script src="signature-pad.js"></script>
<script>
    // Confirm clear codes with enhanced warning
    async function confirmClearCodes() {
        // Use the warning function from readiness-monitors-ui.js
        const confirmed = warnBeforeClearingCodes();
        
        if (confirmed) {
            try {
                // Clear codes
                await window.app.clearCodes();
                alert('‚úÖ Codes cleared successfully!\n\n‚ö†Ô∏è Remember: All readiness monitors have been reset.\nYou need to drive 30-50 miles before emissions testing.');
            } catch (error) {
                alert('‚ùå Failed to clear codes: ' + error.message);
            }
        }
    }
    
    // Auto-update system
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('message', (event) => {
            if (event.data.type === 'NEW_VERSION_AVAILABLE') {
                console.log('üîÑ New version available:', event.data.version);
                document.getElementById('updateBanner').style.display = 'block';
            }
        });
    }

    function updateApp() {
        console.log('üîÑ Updating app...');
        document.getElementById('updateBanner').innerHTML = 
            '<strong>üîÑ Updating... Please wait...</strong>';
        
        // Reload to get new version
        setTimeout(() => {
            window.location.reload(true);
        }, 1000);
    }

    function dismissUpdate() {
        document.getElementById('updateBanner').style.display = 'none';
        // Show again on next page load
        sessionStorage.setItem('updateDismissed', 'true');
    }

    // Check if update was dismissed this session
    if (sessionStorage.getItem('updateDismissed') === 'true') {
        // Don't show banner immediately, but clear flag for next session
        window.addEventListener('beforeunload', () => {
            sessionStorage.removeItem('updateDismissed');
        });
    }

    // Shop Branding Functions
    function showShopSettingsScreen() {
        showScreen('shopSettingsScreen');
        loadShopSettingsBasic();
    }

    function loadShopSettingsBasic() {
        const shopInfo = JSON.parse(localStorage.getItem('shopInfo') || '{}');
        document.getElementById('shopNameInput').value = shopInfo.name || '';
        document.getElementById('shopTaglineInput').value = shopInfo.tagline || '';
        document.getElementById('shopPhoneInput').value = shopInfo.phone || '';
        document.getElementById('shopEmailInput').value = shopInfo.email || '';
        document.getElementById('shopAddressInput').value = shopInfo.address || '';
        document.getElementById('shopLogoInput').value = shopInfo.logo || '';
    }

    function saveShopBasicInfo() {
        const shopInfo = {
            name: document.getElementById('shopNameInput').value,
            tagline: document.getElementById('shopTaglineInput').value,
            phone: document.getElementById('shopPhoneInput').value,
            email: document.getElementById('shopEmailInput').value,
            address: document.getElementById('shopAddressInput').value,
            logo: document.getElementById('shopLogoInput').value
        };
        
        localStorage.setItem('shopInfo', JSON.stringify(shopInfo));
        updateShopBranding();
        alert('‚úÖ Shop information saved!');
        showScreen('homeScreen');
    }

    function updateShopBranding() {
        const shopInfo = JSON.parse(localStorage.getItem('shopInfo') || '{}');
        
        // Update home screen
        if (shopInfo.name) {
            document.getElementById('shopNameDisplay').textContent = shopInfo.name;
        } else {
            document.getElementById('shopNameDisplay').textContent = 'üöó Professional Diagnostic System';
        }
        
        if (shopInfo.tagline) {
            document.getElementById('shopTagline').textContent = shopInfo.tagline;
        } else {
            document.getElementById('shopTagline').textContent = 'Complete Vehicle Assessment &amp; Quote System';
        }
        
        // Update logo
        if (shopInfo.logo) {
            document.getElementById('shopLogo').style.display = 'block';
            document.getElementById('shopLogoImg').src = shopInfo.logo;
        } else {
            document.getElementById('shopLogo').style.display = 'none';
        }
    }

    // Load shop branding on page load
    window.addEventListener('DOMContentLoaded', () => {
        updateShopBranding();
    });

    </script>
       
       <!-- Chart.js for Professional Graphs -->
       <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
       
       <!-- Tesseract.js for OCR -->
       <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.0/dist/tesseract.min.js"></script>
       
       <!-- vLinker MC+ Multi-System Handler -->
       <script src="vlinker-handler-FIXED.js"></script>
       <script src="SIMPLE_UUID_FIX.js"></script>
       
       <!-- Photo Documentation System -->
       <script src="photo-documentation.js"></script>
       
       <!-- jsPDF Library -->
       <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
       
       <!-- PDF Report Generator -->
       <script src="pdf-report-generator.js"></script>
       
       <!-- Camera VIN Scanner -->
       <script src="camera-vin-scanner.js"></script>
       
       <!-- Battery Test -->
       <script src="battery-test.js"></script>
       <script src="battery-test-ui.js"></script>
       
       <!-- Readiness Monitors -->
       <script src="readiness-monitors.js"></script>
       <script src="readiness-monitors-ui.js"></script>
       
       <!-- Mode 6 Analyzer -->
       <script src="unit-converter.js"></script>
       <script src="dtc-database.js"></script>
       <script src="ai-diagnostic-analyzer.js"></script>
       <script src="ai-diagnostic-integrated.js"></script>
       <script src="mode6-analyzer-FIXED.js"></script>
       <script src="mode6-analyzer-ui.js"></script>
       
       <!-- Customer Management System -->
       <script src="customer-management.js"></script>
       
       <!-- Service Advisor Tools -->
       <script src="service-advisor-tools.js"></script>
       
       <!-- Help System -->
       <script src="help-system.js"></script>

      <!-- Firebase SDK -->
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

      <!-- Firebase Configuration and Sync -->
      <script src="firebase-config.js"></script>
      <script src="firebase-sync.js"></script>

      <!-- Social Media Share Generator -->
      <script src="social-share-generator-v2.js"></script>
      <script src="invoice-health-score-patch.js"></script>

    <!-- Help Screen -->

    <!-- Service Advisor Screen -->
    <div id="advisor-screen">
        <div class="advisor-header">
            <h2>üìÖ Service Advisor Dashboard</h2>
            <p>Manage appointments, reminders, and follow-ups</p>
            <div id="advisor-notification-badge"></div>
        </div>

        <div class="advisor-actions-bar">
            <button class="primary" onclick="window.advisorTools.showAddAppointmentDialog()">+ Add Appointment</button>
            <button class="primary" onclick="window.advisorTools.showAddReminderDialog()">+ Add Reminder</button>
            <button class="secondary" onclick="window.advisorTools.generateReport()">üìä Report</button>
            <button class="secondary" onclick="hideServiceAdvisor()">‚úì Done</button>
        </div>

        <div class="advisor-dashboard">
            <!-- Stats Cards -->
            <div id="advisor-stats"></div>

            <!-- Today's Appointments -->
            <div class="dashboard-section">
                <h3>üìÖ Today's Appointments</h3>
                <div id="today-appointments"></div>
            </div>

            <!-- Upcoming Appointments -->
            <div class="dashboard-section">
                <h3>üìÜ Upcoming Appointments (Next 7 Days)</h3>
                <div id="upcoming-appointments"></div>
            </div>

            <!-- Pending Reminders -->
            <div class="dashboard-section">
                <h3>‚è∞ Pending Reminders</h3>
                <div id="reminders-list"></div>
            </div>

            <!-- Follow-ups Due -->
            <div class="dashboard-section">
                <h3>üìû Follow-ups Due</h3>
                <div id="followups-list"></div>
            </div>
        </div>
    </div>

    <!-- Appointment Form Modal -->
    <div id="appointment-form-modal">
        <div class="advisor-form-container">
            <h3>Add Appointment</h3>
            <form id="appointment-form" onsubmit="event.preventDefault(); window.advisorTools.saveAppointment();">
                <div class="form-group">
                    <label for="apt-customer-name">Customer Name *</label>
                    <input type="text" id="apt-customer-name" required>
                </div>
                <div class="form-group">
                    <label for="apt-date">Date *</label>
                    <input type="date" id="apt-date" required>
                </div>
                <div class="form-group">
                    <label for="apt-time">Time *</label>
                    <input type="time" id="apt-time" required>
                </div>
                <div class="form-group">
                    <label for="apt-service">Service *</label>
                    <input type="text" id="apt-service" placeholder="e.g., Oil Change, Brake Inspection" required>
                </div>
                <div class="form-group">
                    <label for="apt-notes">Notes</label>
                    <textarea id="apt-notes" placeholder="Additional notes..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="secondary" onclick="window.advisorTools.closeAppointmentForm()">Cancel</button>
                    <button type="submit" class="primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reminder Form Modal -->
    <div id="reminder-form-modal">
        <div class="advisor-form-container">
            <h3>Add Reminder</h3>
            <form id="reminder-form" onsubmit="event.preventDefault(); window.advisorTools.saveReminder();">
                <div class="form-group">
                    <label for="reminder-customer-name">Customer Name *</label>
                    <input type="text" id="reminder-customer-name" required>
                </div>
                <div class="form-group">
                    <label for="reminder-title">Title *</label>
                    <input type="text" id="reminder-title" placeholder="e.g., Follow-up call" required>
                </div>
                <div class="form-group">
                    <label for="reminder-description">Description *</label>
                    <textarea id="reminder-description" placeholder="What needs to be done..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="reminder-date">Due Date *</label>
                    <input type="date" id="reminder-date" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="secondary" onclick="window.advisorTools.closeReminderForm()">Cancel</button>
                    <button type="submit" class="primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Management Screen -->
    <div id="customer-screen">
        <div class="customer-header">
            <h2>üë• Customer Management</h2>
            <p>Manage customers and track assessment history</p>
        </div>

        <div class="customer-actions-bar">
            <div class="customer-search-box">
                <input type="text" id="customer-search" placeholder="Search customers..." oninput="window.customerMgmt.handleSearch()">
                <span class="search-icon">üîç</span>
            </div>
            <button class="primary" onclick="window.customerMgmt.showAddCustomerDialog()">+ Add Customer</button>
            <button class="secondary" onclick="window.customerMgmt.exportCustomers()">üì• Export</button>
            <button class="secondary" onclick="hideCustomerManagement()">‚úì Done</button>
        </div>

        <!-- Customer List View -->
        <div id="customer-list-view">
            <div id="customer-list"></div>
        </div>

        <!-- Customer Detail View -->
        <div id="customer-detail-view">
            <button class="btn-small" onclick="window.customerMgmt.backToCustomerList()" style="margin-bottom: 15px;">‚Üê Back to List</button>
            <div id="customer-detail-content"></div>
        </div>
    </div>

    <!-- Customer Form Modal -->
    <div id="customer-form-modal">
        <div class="customer-form-container">
            <h3 id="customer-form-title">Add New Customer</h3>
            <form id="customer-form" onsubmit="event.preventDefault(); window.customerMgmt.saveCustomerForm();">
                <div class="form-group">
                    <label for="form-customer-name">Name *</label>
                    <input type="text" id="form-customer-name" required>
                </div>
                <div class="form-group">
                    <label for="form-customer-phone">Phone</label>
                    <input type="tel" id="form-customer-phone">
                </div>
                <div class="form-group">
                    <label for="form-customer-email">Email</label>
                    <input type="email" id="form-customer-email">
                </div>
                <div class="form-group">
                    <label for="form-customer-address">Address</label>
                    <textarea id="form-customer-address"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="secondary" onclick="window.customerMgmt.closeCustomerForm()">Cancel</button>
                    <button type="submit" class="primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Photo Documentation Screen -->
    <div id="photo-screen">
        <div class="photo-header">
            <h2>üì∏ Photo Documentation</h2>
            <p>Capture and annotate vehicle photos</p>
        </div>

        <div class="photo-actions">
            <button class="primary" onclick="startPhotoCapture()">üì∑ Take Photo</button>
            <button class="secondary" onclick="window.photoDoc.hidePhotoScreen()">‚úì Done</button>
        </div>

        <!-- Camera Container -->
        <div id="camera-container">
            <video id="camera-preview" autoplay playsinline></video>
            <div class="camera-controls">
                <select id="photo-category-select">
                    <option value="exterior-front">Exterior - Front</option>
                    <option value="exterior-rear">Exterior - Rear</option>
                    <option value="exterior-left">Exterior - Left Side</option>
                    <option value="exterior-right">Exterior - Right Side</option>
                    <option value="interior-front">Interior - Front</option>
                    <option value="interior-rear">Interior - Rear</option>
                    <option value="dashboard">Dashboard</option>
                    <option value="engine">Engine Bay</option>
                    <option value="undercarriage">Undercarriage</option>
                    <option value="damage">Damage</option>
                    <option value="tires">Tires/Wheels</option>
                    <option value="other">Other</option>
                </select>
                <div class="camera-buttons">
                    <button class="capture" onclick="capturePhoto()">üì∑</button>
                    <button class="done" onclick="stopPhotoCapture()">‚úì Done</button>
                </div>
            </div>
        </div>

        <!-- Photo Gallery Container -->
        <div id="photo-gallery-container">
            <div class="gallery-stats">
                <h3 id="photo-count">0 photos</h3>
            </div>
            <div id="photo-gallery">
                <div class="photo-empty-state">
                    <div class="icon">üì∑</div>
                    <h3>No Photos Yet</h3>
                    <p>Tap "Take Photo" to start documenting the vehicle</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Viewer -->
    <div id="photo-viewer">
        <button class="viewer-close" onclick="closePhotoViewer()">‚úï</button>
        <img id="viewer-image" src="" alt="Photo">
    </div>

    <!-- Annotation Container -->
    <div id="annotation-container">
        <div class="annotation-header">
            <h3>‚úèÔ∏è Annotate Photo</h3>
        </div>
        <div class="annotation-tools">
            <button id="annotation-pen" class="active">‚úèÔ∏è Pen</button>
            <button id="annotation-arrow">‚û°Ô∏è Arrow</button>
            <button id="annotation-text">üìù Text</button>
            <input type="color" id="annotation-color" value="#FF0000">
        </div>
        <div class="annotation-canvas-container">
            <canvas id="annotation-canvas"></canvas>
        </div>
        <div class="annotation-actions">
            <button class="save" onclick="savePhotoAnnotations()">üíæ Save</button>
            <button class="cancel" onclick="cancelPhotoAnnotations()">‚úï Cancel</button>
        </div>
    </div>

<!-- Version Footer -->
    <div style="text-align: center; padding: 20px; color: #6c757d; font-size: 12px; background: #f8f9fa; border-top: 1px solid #dee2e6;">
        <strong>Professional Diagnostic System</strong> v3.0<br>
        <small>Complete Vehicle Assessment &amp; Quote System</small>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- License System Integration -->
    <script src="license-generator.js"></script>
    <script src="license-validator.js"></script>
    <script src="license-integration.js"></script>
    
    <!-- Payment Integrations -->
    <script src="stripe-checkout.js"></script>
    <script src="paypal-checkout.js"></script>
    
    <!-- Email Integration -->
    <script src="sendgrid-sender.js"></script>
    
    <!-- Firebase Cloud Sync -->
    <script src="firebase-sync.js"></script>
    
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD940ru177a_FPB0S2PZJrFyOVZkVPUe8I",
            authDomain: "vhicl-pro-cloud-sync.firebaseapp.com",
            projectId: "vhicl-pro-cloud-sync",
            storageBucket: "vhicl-pro-cloud-sync.firebasestorage.app",
            messagingSenderId: "817636291896",
            appId: "1:817636291896:web:ea5fa0b1c0b5503556fdcd"
        };
        
        firebase.initializeApp(firebaseConfig);
        window.db = firebase.firestore();
        
        console.log('‚úÖ Firebase initialized - Cloud sync enabled!');
        
        // Initialize Pro license check on load
        window.addEventListener('DOMContentLoaded', async () => {
            if (typeof window.proLicenseManager !== 'undefined') {
                await window.proLicenseManager.initialize();
            }
            
            // Initialize Firebase sync
            if (typeof window.firebaseSync !== 'undefined') {
                console.log('‚úÖ Firebase Cloud Sync ready!');
                console.log('üì± Data will sync across all devices automatically');
            }
        });
    </script>

<script src="tech-workflow.js"></script>
    <script src="grok-voice-integration.js"></script>
    <script src="grok-auto-order.js"></script>
    <script src="customer-management-firebase.js"></script>
    <script src="vehicle-management-firebase.js"></script>
    <script src="customer-portal.js"></script>
    <script src="towing-integration.js"></script>
    <script src="inventory-system.js"></script>
    <script src="inventory-quote-integration.js"></script>
    <script src="bay-balancing.js"></script>
    <script src="appointment-booking.js"></script>
    <script src="ai-phone-integration.js"></script>
    <script src="ai-phone-dashboard.js"></script>
    <script src="ai-phone-system-setup.js"></script>
    <script src="grok-safety-assessment.js"></script>
    <script src="grok-safety-no-mobile-techs.js"></script>
    <script src="customer-payment-integration.js"></script>
    <script src="signature-pad.js"></script>
    <script src="photo-documentation.js"></script>
    <script src="pdf-report-generator.js"></script>
<script src="face-recognition-checkin.js"></script>
    <script src="customer-management-firebase.js"></script>
    <script src="vehicle-management-firebase.js"></script>
    <script src="customer-portal.js"></script>
    <script src="bay-balancing.js"></script>
    <script src="inventory-system.js"></script>
    <script src="inventory-quote-integration.js"></script>
    <script src="appointment-booking.js"></script>
    <script src="ai-phone-integration.js"></script>
    <script src="ai-phone-dashboard.js"></script>
    <script src="signature-pad.js"></script>
    <script src="customer-payment-integration.js"></script>
    <script src="towing-integration.js"></script>
    <script src="grok-safety-assessment.js"></script>
    <script src="grok-voice-integration.js"></script>
    <script src="tech-workflow.js"></script>
</body>
</html>
