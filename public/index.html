<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VHICL Pro - Complete Shop Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .navbar {
            background: #2c3e50;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .navbar h1 {
            color: white;
            font-size: 24px;
            margin: 0;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: #3498db;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #3498db;
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.4);
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card .stat {
            font-size: 36px;
            font-weight: 700;
            color: #3498db;
            margin-bottom: 10px;
        }

        .card .label {
            color: #7f8c8d;
            font-size: 14px;
        }

        .card.success .stat {
            color: #27ae60;
        }

        .card.warning .stat {
            color: #f39c12;
        }

        .card.danger .stat {
            color: #e74c3c;
        }

        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            min-width: 250px;
        }

        .half {
            flex: 0 0 calc(50% - 10px);
        }

        .third {
            flex: 0 0 calc(33.333% - 13px);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.success {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .nav-buttons {
                width: 100%;
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .row {
                flex-direction: column;
            }

            .half,
            .third {
                flex: 1;
            }
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="navbar">
        <h1>üöó VHICL Pro</h1>
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showScreen('homeScreen')">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="nav-btn" onclick="showScreen('alexScreen')">
                <i class="fas fa-robot"></i> ALEX
            </button>
            <button class="nav-btn" onclick="showScreen('appointmentsScreen')">
                <i class="fas fa-calendar"></i> Appointments
            </button>
            <button class="nav-btn" onclick="showScreen('partsStoresScreen')">
                <i class="fas fa-store"></i> Parts Stores
            </button>
            <button class="nav-btn" onclick="showScreen('analyticsScreen')">
                <i class="fas fa-chart-line"></i> Analytics
            </button>
            <button class="nav-btn" onclick="showScreen('techFlowScreen')">
                <i class="fas fa-user-tie"></i> Tech Flow
            </button>
            <button class="nav-btn" onclick="showScreen('settingsScreen')">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Screen -->
        <div id="homeScreen" class="screen active">
            <div class="section">
                <h2>üìä Today's Overview</h2>
                <div class="dashboard-grid">
                    <div class="card success">
                        <h3><i class="fas fa-dollar-sign"></i> Revenue</h3>
                        <div class="stat" id="todayRevenue">$0.00</div>
                        <div class="label">Total revenue today</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-wrench"></i> Jobs</h3>
                        <div class="stat" id="todayJobs">0</div>
                        <div class="label">Jobs completed today</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-calendar-check"></i> Appointments</h3>
                        <div class="stat" id="todayAppointments">0</div>
                        <div class="label">Appointments today</div>
                    </div>
                    <div class="card warning">
                        <h3><i class="fas fa-users"></i> Walk-ins</h3>
                        <div class="stat" id="todayWalkIns">0</div>
                        <div class="label">Walk-in customers today</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>‚ö° Quick Actions</h2>
                <div class="row">
                    <button class="btn btn-primary" onclick="showScreen('appointmentsScreen')">
                        <i class="fas fa-plus"></i> New Appointment
                    </button>
                    <button class="btn btn-success" onclick="showScreen('alexScreen')">
                        <i class="fas fa-phone"></i> Call Parts Store
                    </button>
                    <button class="btn btn-warning" onclick="showScreen('partsStoresScreen')">
                        <i class="fas fa-box"></i> Check Parts Availability
                    </button>
                    <button class="btn btn-danger" onclick="showScreen('settingsScreen')">
                        <i class="fas fa-cog"></i> Configure Shop
                    </button>
                </div>
            </div>
        </div>

        <!-- ALEX Screen -->
        <div id="alexScreen" class="screen">
            <div class="section">
                <h2>ü§ñ ALEX - Voice Assistant Configuration</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-phone"></i> Voice Calling</h3>
                        <div class="stat">
                            <span class="status-badge success">ENABLED</span>
                        </div>
                        <div class="label">ALEX can call parts stores automatically</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-shopping-cart"></i> Parts Ordering</h3>
                        <div class="stat">
                            <span class="status-badge success">ENABLED</span>
                        </div>
                        <div class="label">ALEX can order parts after approval</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-envelope"></i> Confirmations</h3>
                        <div class="stat">
                            <span class="status-badge success">ENABLED</span>
                        </div>
                        <div class="label">ALEX sends email confirmations</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-calendar-alt"></i> Appointments</h3>
                        <div class="stat">
                            <span class="status-badge success">ENABLED</span>
                        </div>
                        <div class="label">ALEX can book appointments</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üö´ Services We Don't Do</h2>
                <p style="color: #7f8c8d; margin-bottom: 15px;">
                    Configure services that ALEX should NOT book appointments for. ALEX will politely decline if a customer requests these services.
                </p>
                
                <div class="form-group">
                    <label>Add Service We Don't Do</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="serviceNotOffered" placeholder="e.g., Transmission Rebuild, Body Work, Glass Repair">
                        <button class="btn btn-danger" onclick="addServiceNotOffered()">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Services We Don't Do</label>
                    <div id="servicesWeDontDoList" style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <!-- Services will be added here -->
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìû ALEX Actions</h2>
                <div class="row">
                    <button class="btn btn-primary" onclick="alexCallStores()">
                        <i class="fas fa-phone"></i> Call Parts Stores for Pricing
                    </button>
                    <button class="btn btn-success" onclick="alexOrderParts()">
                        <i class="fas fa-shopping-cart"></i> Order Parts
                    </button>
                    <button class="btn btn-warning" onclick="alexCheckAvailability()">
                        <i class="fas fa-box"></i> Check Parts Availability
                    </button>
                </div>
            </div>

            <div class="section">
                <h2>üìä ALEX Activity</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Action</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="alexActivityLog">
                        <tr>
                            <td colspan="3" style="text-align: center; color: #7f8c8d;">No recent activity</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Appointments Screen -->
        <div id="appointmentsScreen" class="screen">
            <div class="section">
                <h2>üìÖ Appointments</h2>
                
                <div class="form-group">
                    <div class="row">
                        <div class="third">
                            <input type="text" id="searchAppointments" placeholder="Search appointments..." onkeyup="searchAppointments()">
                        </div>
                        <div class="third">
                            <select id="filterAppointments" onchange="filterAppointments()">
                                <option value="all">All Appointments</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                        </div>
                        <div class="third">
                            <button class="btn btn-primary" style="width: 100%;" onclick="createNewAppointment()">
                                <i class="fas fa-plus"></i> New Appointment
                            </button>
                        </div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Service</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="appointmentsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">No appointments found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Parts Stores Screen -->
        <div id="partsStoresScreen" class="screen">
            <div class="section">
                <h2>üè™ Parts Stores</h2>
                
                <div class="form-group">
                    <div class="row">
                        <div class="half">
                            <input type="text" id="searchPartsStores" placeholder="Search stores..." onkeyup="searchPartsStores()">
                        </div>
                        <div class="half">
                            <button class="btn btn-primary" style="width: 100%;" onclick="addNewPartsStore()">
                                <i class="fas fa-plus"></i> Add Parts Store
                            </button>
                        </div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Store Name</th>
                            <th>Phone</th>
                            <th>Discount</th>
                            <th>Delivery</th>
                            <th>Priority</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="partsStoresTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">No parts stores found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Screen -->
        <div id="analyticsScreen" class="screen">
            <div class="section">
                <h2>üìä Revenue Analytics</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-calendar-day"></i> Today</h3>
                        <div class="stat" id="analyticsTodayRevenue">$0.00</div>
                        <div class="label">Revenue today</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-calendar-week"></i> This Week</h3>
                        <div class="stat" id="analyticsWeekRevenue">$0.00</div>
                        <div class="label">Revenue this week</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-calendar-month"></i> This Month</h3>
                        <div class="stat" id="analyticsMonthRevenue">$0.00</div>
                        <div class="label">Revenue this month</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-calendar-alt"></i> This Year</h3>
                        <div class="stat" id="analyticsYearRevenue">$0.00</div>
                        <div class="label">Revenue this year</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìà Job Analytics</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-wrench"></i> Total Jobs</h3>
                        <div class="stat" id="analyticsTotalJobs">0</div>
                        <div class="label">Jobs completed</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-clock"></i> Avg. Labor Time</h3>
                        <div class="stat" id="analyticsAvgLaborTime">0.0 hrs</div>
                        <div class="label">Average job duration</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-users"></i> Customers</h3>
                        <div class="stat" id="analyticsCustomers">0</div>
                        <div class="label">Unique customers</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-dollar-sign"></i> Avg. Job Value</h3>
                        <div class="stat" id="analyticsAvgJobValue">$0.00</div>
                        <div class="label">Average ticket</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîß Parts Analytics</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-store"></i> Parts Stores</h3>
                        <div class="stat" id="analyticsPartsStores">0</div>
                        <div class="label">Active parts stores</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-percent"></i> Avg. Discount</h3>
                        <div class="stat" id="analyticsAvgDiscount">0%</div>
                        <div class="label">Average discount rate</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-box"></i> Parts Ordered</h3>
                        <div class="stat" id="analyticsPartsOrdered">0</div>
                        <div class="label">Parts ordered this month</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-truck"></i>Deliveries</h3>
                        <div class="stat" id="analyticsDeliveries">0</div>
                        <div class="label">Successful deliveries</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tech Flow Screen -->
        <div id="techFlowScreen" class="screen">
            <div class="section">
                <h2>üë∑ Technician Dashboard</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i class="fas fa-tools"></i> Active Jobs</h3>
                        <div class="stat" id="techActiveJobs">0</div>
                        <div class="label">Jobs currently in progress</div>
                    </div>
                    <div class="card success">
                        <h3><i class="fas fa-check-circle"></i> Completed Today</h3>
                        <div class="stat" id="techCompletedToday">0</div>
                        <div class="label">Jobs completed today</div>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-clock"></i> Total Hours</h3>
                        <div class="stat" id="techTotalHours">0.0</div>
                        <div class="label">Hours worked today</div>
                    </div>
                    <div class="card warning">
                        <h3><i class="fas fa-star"></i> Rating</h3>
                        <div class="stat" id="techRating">0.0</div>
                        <div class="label">Customer rating (out of 5)</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîß Active Jobs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Service</th>
                            <th>Bay</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="techActiveJobsTable">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #7f8c8d;">No active jobs</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2>‚úÖ Recent Completed Jobs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Service</th>
                            <th>Hours</th>
                            <th>Completed</th>
                        </tr>
                    </thead>
                    <tbody id="techCompletedJobsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #7f8c8d;">No completed jobs today</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <h2>‚ö° Quick Actions</h2>
                <div class="row">
                    <button class="btn btn-primary" onclick="techStartJob()">
                        <i class="fas fa-play"></i> Start Job
                    </button>
                    <button class="btn btn-success" onclick="techCompleteJob()">
                        <i class="fas fa-check"></i> Complete Job
                    </button>
                    <button class="btn btn-warning" onclick="techRequestParts()">
                        <i class="fas fa-box"></i> Request Parts
                    </button>
                    <button class="btn btn-primary" onclick="techAddNote()">
                        <i class="fas fa-sticky-note"></i> Add Note
                    </button>
                    <button class="btn btn-danger" onclick="techViewSchedule()">
                        <i class="fas fa-calendar"></i> View Schedule
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settingsScreen" class="screen">
            <div class="section">
                <h2>‚öôÔ∏è Shop Settings</h2>
                <p style="color: #7f8c8d; margin-bottom: 20px;">
                    Configure your shop's settings, credentials, and preferences. Click below to open the complete settings page.
                </p>
                <button class="btn btn-primary" onclick="window.location.href='settings-complete-with-all-settings.html'">
                    <i class="fas fa-cog"></i> Open Complete Settings
                </button>
            </div>
        </div>
    </div>

    <script>
        // Services We Don't Do
        let servicesWeDontDo = [];

        // Load services we don't do from backend
        async function loadServicesWeDontDo() {
            try {
                const response = await fetch('/api/alex/config');
                const config = await response.json();
                servicesWeDontDo = config.servicesWeDontDo || [];
                renderServicesWeDontDo();
            } catch (error) {
                console.error('Error loading services:', error);
            }
        }

        // Add service we don't do
        async function addServiceNotOffered() {
            const input = document.getElementById('serviceNotOffered');
            const service = input.value.trim();
            
            if (!service) {
                alert('Please enter a service name');
                return;
            }
            
            if (servicesWeDontDo.includes(service)) {
                alert('This service is already in the list');
                return;
            }
            
            servicesWeDontDo.push(service);
            input.value = '';
            
            // Save to backend
            try {
                await fetch('/api/alex/services-we-dont-do', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ services: servicesWeDontDo })
                });
                
                renderServicesWeDontDo();
            } catch (error) {
                console.error('Error saving service:', error);
            }
        }

        // Remove service we don't do
        async function removeServiceNotOffered(service) {
            servicesWeDontDo = servicesWeDontDo.filter(s => s !== service);
            
            // Save to backend
            try {
                await fetch('/api/alex/services-we-dont-do', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ services: servicesWeDontDo })
                });
                
                renderServicesWeDontDo();
            } catch (error) {
                console.error('Error saving service:', error);
            }
        }

        // Render services we don't do
        function renderServicesWeDontDo() {
            const container = document.getElementById('servicesWeDontDoList');
            
            if (servicesWeDontDo.length === 0) {
                container.innerHTML = '<span style="color: #7f8c8d;">No services configured - ALEX will book all service types</span>';
                return;
            }
            
            container.innerHTML = servicesWeDontDo.map(service => `
                <span class="status-badge danger" style="cursor: pointer;" onclick="removeServiceNotOffered('${service}')">
                    ${service} <i class="fas fa-times"></i>
                </span>
            `).join('');
        }

        // Screen navigation
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data for specific screens
            if (screenId === 'analyticsScreen') {
                loadAnalytics();
            }
            if (screenId === 'partsStoresScreen') {
                loadPartsStores();
            }
            if (screenId === 'alexScreen') {
                loadServicesWeDontDo();
            }
            if (screenId === 'techFlowScreen') {
                loadTechWorkflow();
            }
        }

        // ALEX Actions
        async function alexCallStores() {
            alert('ALEX will call parts stores for pricing. This feature requires VAPI configuration.');
        }

        async function alexOrderParts() {
            alert('ALEX will order parts. This feature requires VAPI configuration.');
        }

        async function alexCheckAvailability() {
            alert('ALEX will check parts availability. This feature requires Nexpart configuration.');
        }

        // Load Analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/api/analytics/overview');
                const data = await response.json();
                
                document.getElementById('analyticsTodayRevenue').textContent = '$' + (data.today?.revenue || 0).toFixed(2);
                document.getElementById('analyticsWeekRevenue').textContent = '$' + (data.thisWeek?.revenue || 0).toFixed(2);
                document.getElementById('analyticsMonthRevenue').textContent = '$' + (data.thisMonth?.revenue || 0).toFixed(2);
                document.getElementById('analyticsYearRevenue').textContent = '$' + (data.thisYear?.revenue || 0).toFixed(2);
                
                document.getElementById('todayRevenue').textContent = '$' + (data.today?.revenue || 0).toFixed(2);
                document.getElementById('todayJobs').textContent = data.today?.jobs || 0;
                document.getElementById('todayAppointments').textContent = data.today?.appointments || 0;
                document.getElementById('todayWalkIns').textContent = data.today?.walkIns || 0;
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
            
            // Load labor analytics
            try {
                const laborResponse = await fetch('/api/analytics/labor');
                const laborData = await laborResponse.json();
                
                document.getElementById('analyticsTotalJobs').textContent = laborData.totalOperations || 0;
                document.getElementById('analyticsAvgLaborTime').textContent = (laborData.averageLaborTime || 0).toFixed(1) + ' hrs';
            } catch (error) {
                console.error('Error loading labor analytics:', error);
            }
            
            // Load parts analytics
            try {
                const partsResponse = await fetch('/api/analytics/parts');
                const partsData = await partsResponse.json();
                
                document.getElementById('analyticsPartsStores').textContent = partsData.totalStores || 0;
                document.getElementById('analyticsAvgDiscount').textContent = (partsData.averageDiscount || 0).toFixed(1) + '%';
            } catch (error) {
                console.error('Error loading parts analytics:', error);
            }
        }

        // Load Parts Stores
        async function loadPartsStores() {
            try {
                const response = await fetch('/api/parts/stores');
                const stores = await response.json();
                
                const tbody = document.getElementById('partsStoresTable');
                
                if (!stores || stores.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No parts stores found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = stores.map(store => `
                    <tr>
                        <td><strong>${store.name}</strong></td>
                        <td>${store.phone}</td>
                        <td><span class="status-badge success">${store.discountRate || 0}%</span></td>
                        <td>${store.deliveryTime || 'Same day'}</td>
                        <td><span class="status-badge ${store.priority === 1 ? 'success' : 'warning'}">${store.priority || 'normal'}</span></td>
                        <td>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;" onclick="editPartsStore('${store.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="deletePartsStore('${store.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading parts stores:', error);
                document.getElementById('partsStoresTable').innerHTML = 
                    '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">Error loading parts stores</td></tr>';
            }
        }

        // Add new parts store
        function addNewPartsStore() {
            const name = prompt('Enter store name:');
            if (!name) return;
            
            const phone = prompt('Enter phone number:');
            if (!phone) return;
            
            const discount = prompt('Enter discount rate (%):', '0');
            const delivery = prompt('Enter delivery time:', 'Same day');
            const priority = prompt('Enter priority (1-3, lower is higher priority):', '2');
            
            fetch('/api/parts/stores', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name,
                    phone,
                    discountRate: parseFloat(discount) || 0,
                    deliveryTime: delivery || 'Same day',
                    priority: parseInt(priority) || 2,
                    active: true
                })
            }).then(() => {
                loadPartsStores();
                alert('Parts store added successfully!');
            }).catch(error => {
                alert('Error adding parts store: ' + error.message);
            });
        }

        // Edit parts store
        function editPartsStore(storeId) {
            alert('Edit functionality coming soon');
        }

        // Delete parts store
        function deletePartsStore(storeId) {
            if (!confirm('Are you sure you want to delete this parts store?')) return;
            
            fetch(`/api/parts/stores/${storeId}`, {
                method: 'DELETE'
            }).then(() => {
                loadPartsStores();
                alert('Parts store deleted successfully!');
            }).catch(error => {
                alert('Error deleting parts store: ' + error.message);
            });
        }

        // Search parts stores
        function searchPartsStores() {
            // Implement search functionality
            console.log('Searching parts stores...');
        }

        // Appointments
        function createNewAppointment() {
            alert('Appointment creation form will open here');
        }

        function searchAppointments() {
            console.log('Searching appointments...');
        }

        function filterAppointments() {
            console.log('Filtering appointments...');
        }

        // Load Tech Workflow Data
        async function loadTechWorkflow() {
            try {
                const response = await fetch('/api/tech/stats');
                const stats = await response.json();
                
                document.getElementById('techActiveJobs').textContent = stats.activeJobs;
                document.getElementById('techCompletedToday').textContent = stats.completedToday;
                document.getElementById('techTotalHours').textContent = stats.totalHours.toFixed(1);
                document.getElementById('techRating').textContent = stats.rating;
                
                // Load active jobs
                loadTechActiveJobs();
                loadTechCompletedJobs();
            } catch (error) {
                console.error('Error loading tech workflow:', error);
            }
        }

        // Load Active Jobs
        async function loadTechActiveJobs() {
            try {
                const response = await fetch('/api/tech/jobs/active');
                const data = await response.json();
                
                const tbody = document.getElementById('techActiveJobsTable');
                
                if (data.jobs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #7f8c8d;">No active jobs</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.jobs.map(job => `
                    <tr>
                        <td><strong>${job.id}</strong></td>
                        <td>${job.customerName || 'N/A'}</td>
                        <td>${job.vehicleInfo || 'N/A'}</td>
                        <td>${job.serviceDescription || 'N/A'}</td>
                        <td><span class="status-badge warning">Bay ${job.bay || 'TBD'}</span></td>
                        <td>${job.progress}%</td>
                        <td>
                            <button class="btn btn-success" style="padding: 5px 10px; font-size: 12px;" onclick="completeTechJob('${job.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;" onclick="addTechNote('${job.id}')">
                                <i class="fas fa-sticky-note"></i>
                            </button>
                            <button class="btn btn-warning" style="padding: 5px 10px; font-size: 12px;" onclick="requestTechParts('${job.id}')">
                                <i class="fas fa-box"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading active jobs:', error);
            }
        }

        // Load Completed Jobs
        async function loadTechCompletedJobs() {
            try {
                const response = await fetch('/api/tech/jobs/completed');
                const data = await response.json();
                
                const tbody = document.getElementById('techCompletedJobsTable');
                
                if (data.jobs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d;">No completed jobs today</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.jobs.map(job => `
                    <tr>
                        <td><strong>${job.id}</strong></td>
                        <td>${job.customerName || 'N/A'}</td>
                        <td>${job.vehicleInfo || 'N/A'}</td>
                        <td>${job.serviceDescription || 'N/A'}</td>
                        <td>${job.hours || 0} hrs</td>
                        <td>${new Date(job.completedAt).toLocaleTimeString()}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading completed jobs:', error);
            }
        }

        // Technician Functions
        async function techStartJob() {
            const customerName = prompt('Customer name:');
            const vehicleInfo = prompt('Vehicle info:');
            const serviceDescription = prompt('Service description:');
            const bay = prompt('Bay number:');
            
            if (!customerName || !vehicleInfo || !serviceDescription) {
                alert('Please fill in all fields');
                return;
            }
            
            try {
                const response = await fetch('/api/tech/jobs/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customerName,
                        vehicleInfo,
                        serviceDescription,
                        bay
                    })
                });
                
                const result = await response.json();
                alert('Job started: ' + result.job.id);
                loadTechActiveJobs();
            } catch (error) {
                alert('Error starting job: ' + error.message);
            }
        }

        async function completeTechJob(jobId) {
            if (!confirm('Complete this job?')) return;
            
            const rating = prompt('Customer rating (1-5):', '5');
            
            try {
                const response = await fetch(`/api/tech/jobs/${jobId}/complete`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        rating: parseInt(rating) || 5
                    })
                });
                
                const result = await response.json();
                alert('Job completed successfully!');
                loadTechActiveJobs();
                loadTechCompletedJobs();
                loadTechWorkflow();
            } catch (error) {
                alert('Error completing job: ' + error.message);
            }
        }

        async function requestTechParts(jobId) {
            const parts = prompt('Enter parts needed:');
            if (!parts) return;
            
            try {
                const response = await fetch(`/api/tech/jobs/${jobId}/parts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ parts })
                });
                
                const result = await response.json();
                alert('Parts requested: ' + parts);
            } catch (error) {
                alert('Error requesting parts: ' + error.message);
            }
        }

        async function addTechNote(jobId) {
            const note = prompt('Enter technician note:');
            if (!note) return;
            
            try {
                const response = await fetch(`/api/tech/jobs/${jobId}/notes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ note })
                });
                
                const result = await response.json();
                alert('Note added successfully!');
            } catch (error) {
                alert('Error adding note: ' + error.message);
            }
        }

        async function techViewSchedule() {
            try {
                const response = await fetch('/api/tech/schedule');
                const schedule = await response.json();
                
                let scheduleText = 'TECHNICIAN SCHEDULE\n\n';
                scheduleText += 'Today\'s Jobs:\n';
                schedule.today.forEach(job => {
                    scheduleText += `- ${job.id}: ${job.serviceDescription}\n`;
                });
                
                scheduleText += '\nThis Week\'s Jobs:\n';
                schedule.thisWeek.forEach(job => {
                    scheduleText += `- ${job.id}: ${job.serviceDescription} (${new Date(job.scheduledDate).toLocaleDateString()})\n`;
                });
                
                alert(scheduleText || 'No upcoming jobs');
            } catch (error) {
                alert('Error loading schedule: ' + error.message);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadServicesWeDontDo();
            loadAnalytics();
            loadPartsStores();
            loadTechWorkflow();
        });
    </script>
</body>
</html>
